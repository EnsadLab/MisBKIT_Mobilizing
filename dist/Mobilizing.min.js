// mobilizing-js.net/license
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e(t.Mobilizing=t.Mobilizing||{},t.THREE)}(this,function(t,e){"use strict";function i(t,e,i){return void 0!==t&&e in t?t[e]:i}function n(t,e,i){for(var n=arguments.length,o=Array(n>3?n-3:0),s=3;s<n;s++)o[s-3]=arguments[s];return void 0!==t&&e in t?t[e]:i.apply(void 0,o)}function o(t,e,i){for(var n=arguments.length,o=Array(n>3?n-3:0),s=3;s<n;s++)o[s-3]=arguments[s];return void 0!==t&&e in t?t[e]:new(Function.prototype.bind.apply(i,[null].concat(o)))}function s(t){var e=void 0;return function(){if(void 0===e){for(var i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];e=new(Function.prototype.bind.apply(t,[null].concat(n)))}return e}}var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=function(){function t(t,e){var i=[],n=!0,o=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function t(e){r(this,t),this.renderer=i(e,"renderer",void 0),this.arrayBuffer=i(e,"arrayBuffer",void 0),this.decodedCallback=i(e,"decodedCallback",void 0),this.arrayBuffer&&this.renderer.audioContext.decodeAudioData(this.arrayBuffer,function(t){this.buffer=t,this.decodedCallback()}.bind(this))}return a(t,[{key:"getInternalAudioBuffer",value:function(){return this.buffer}}]),t}(),f=function(){function t(e){r(this,t),this._context=i(e,"context",null),this._name="unnamed",this._id=Date.now()+"_"+Math.floor(1e6*Math.random())}return a(t,[{key:"setContext",value:function(t){this._context=t}},{key:"getContext",value:function(){return this._context}},{key:"setName",value:function(t){this._name=t}},{key:"getName",value:function(){return this._name}},{key:"getID",value:function(){return this._id}}]),t}(),v=function(){function t(e){r(this,t),this._scope=i(e,"scope",this),this.listeners={}}return a(t,[{key:"on",value:function(t,e){return void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(e),this}},{key:"off",value:function(t,e){var i;if(this.listeners[t]instanceof Array)if(void 0===e)this.listeners[t]={};else{i=this.listeners[t];for(var n=0,o=i.length;n<o;n++)if(i[n]===e){i.splice(n,1);break}}return this}},{key:"trigger",value:function(t){for(var e=this,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];var s;return this.listeners[t]instanceof Array&&(s=this.listeners[t],s.forEach(function(t){t.call.apply(t,[e._scope].concat(n))})),this}}]),t}(),g=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._active=!1,i._setupDone=!1,i.events=new v({scope:i}),i._nexts=[],i}return u(e,t),a(e,[{key:"setup",value:function(){this._setupDone||(this._setupDone=!0)}},{key:"preLoad",value:function(){}},{key:"on",value:function(){this._active=!0}},{key:"off",value:function(){this._active=!1}},{key:"byPass",value:function(){}},{key:"getStatus",value:function(){return this._active}},{key:"preUpdate",value:function(){}},{key:"update",value:function(){}},{key:"postUpdate",value:function(){}},{key:"chain",value:function(t){this._nexts.push(t)}},{key:"getChainedComponents",value:function(){return this._nexts}}]),e}(f),y=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.renderer=i(t,"renderer",void 0),n.panner,void 0!==n.renderer.audioContext&&(n.panner=n.renderer.audioContext.createPanner(),n.panner.panningModel="HRTF",n.panner.distanceModel="exponential",n.panner.refDistance=10,n.panner.maxDistance=1e4,n.panner.rolloffFactor=1,n.panner.coneInnerAngle=360,n.panner.coneOuterAngle=0,n.panner.coneOuterGain=0),n.is3D=!1,n.loop=!1,n}return u(e,t),a(e,[{key:"setRefDistance",value:function(t){this.panner.refDistance=t}},{key:"setMaxDistance",value:function(t){this.panner.maxDistance=t}},{key:"setBuffer",value:function(t){this.buffer=t}},{key:"set3D",value:function(t){this.is3D=t}},{key:"setTransform",value:function(t){this.transform=t}},{key:"setLoop",value:function(t){this.loop=t}},{key:"update",value:function(){if(void 0!==this.transform){var t=this.transform.getLocalPosition();this.panner.setPosition(t.x,t.y,t.z)}}},{key:"on",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),this.play()}},{key:"off",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this.stop()}},{key:"play",value:function(){void 0!==this.renderer.audioContext&&(void 0!==this.source&&this.stop(),this.source=this.renderer.audioContext.createBufferSource(),this.is3D?(this.source.connect(this.panner),this.panner.connect(this.renderer.audioContext.destination)):this.source.connect(this.renderer.audioContext.destination),this.source.buffer=this.buffer.buffer),void 0!==this.source&&(this.playing=!0,this.loop&&(this.source.loop=!0),this.source.start(0))}},{key:"pause",value:function(){void 0!==this.source&&(this.playing=!1)}},{key:"stop",value:function(){void 0!==this.source&&(this.source.stop(0),this.source=void 0,this.playing=!1)}}]),e}(g),p=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),a(e,[{key:"setTo",value:function(t){return this.r=t,this.g=t,this.b=t,this}},{key:"setRGB32",value:function(t,e,i){this.r=t/255,this.g=e/255,this.b=i/255}},{key:"makeRGBAStringWithAlpha",value:function(t){return"rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+t+")"}},{key:"copy",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copy",this).call(this)}}],[{key:"Create",value:function(t,i,n){return new e(t,i,n)}},{key:"random",value:function(){return new e(Math.random(),Math.random(),Math.random())}}]),e}(e.Color);p.green=new p(0,1,0),p.blue=new p(0,0,1),p.red=new p(1,0,0),p.white=new p(1,1,1),p.darkGray=new p(.3,.3,.3),p.gray=new p(.5,.5,.5),p.lightGray=new p(.8,.8,.8),p.black=new p(0,0,0),p.cyan=new p(0,1,1),p.magenta=new p(1,0,1),p.yellow=new p(1,1,0),p.lightRed=new p(1,.5,.5),p.lightGreen=new p(.5,1,.5),p.lightBlue=new p(.5,.5,1),p.mobilizing=new p(60/255,30/255,1),p.mobilizingDark=new p(36/255,18/255,.6),p.mobilizingLight=new p(208/255,202/255,247/255),p.mobilizingAlternate=new p(1,158/255,116/255),p.transparent=new p((new p).makeRGBAStringWithAlpha(0));var m=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(e.Euler),_=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(e.Matrix3),x=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(e.Matrix4),k=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(e.Quaternion),w=function(){function t(e,i,n,o){r(this,t),this.x=e,this.y=i,this.width=n,this.height=o}return a(t,[{key:"toArray",value:function(){return[this.x,this.y,this.width,this.height]}},{key:"fromArray",value:function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}}]),t}(),b=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),a(e,[{key:"rotate90CW",value:function(){var t=this.x,e=this.y;this.x=e,this.y=-t}},{key:"rotate90CCW",value:function(){var t=this.x,e=this.y;this.x=-e,this.y=t}}]),e}(e.Vector2);b.one=new b(1,1),b.zero=new b(0,0);var C=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),e}(e.Vector3);C.one=new C(1,1,1),C.zero=new C(0,0,0);var T=function(){function t(){r(this,t)}return a(t,null,[{key:"randomFromTo",value:function(t,e){return Math.random()*(e-t)+t}},{key:"map",value:function(t,e,i,n,o){return n+(o-n)*(t-e)/(i-e)}},{key:"degToRad",value:function(t){return t*(Math.PI/180)}},{key:"radToDeg",value:function(t){return t*(180/Math.PI)}},{key:"dist",value:function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))}},{key:"lerp",value:function(t,e,i){return t+(e-t)*i}},{key:"clamp",value:function(t,e,i){return Math.min(i,Math.max(e,t))}},{key:"pointIsInside",value:function(t,e,i){var n=void 0,o=i.length-1,s=!1;for(n=0;n<i.length;n++)(i[n].y<e&&i[o].y>=e||i[o].y<e&&i[n].y>=e)&&i[n].x+(e-i[n].y)/(i[o].y-i[n].y)*(i[o].x-i[n].x)<t&&(s=!s),o=n;return s}},{key:"intersectionPoint",value:function(t,e){var i=t[1].x-t[0].x,n=e[0].x-e[1].x,o=e[0].x-t[0].x,s=t[1].y-t[0].y,r=e[0].y-e[1].y,a=e[0].y-t[0].y,h=void 0;return h=n*a==0&&r*o==0&&s*n==0&&i*r==0?0:(n*a-r*o)/(s*n-i*r),{x:t[0].x+h*(t[1].x-t[0].x),y:t[0].y+h*(t[1].y-t[0].y)}}}]),t}(),S=window.location.search.search("[?&]debug(=([^&#]*)|&|#|$)")>-1,M=function(){function t(e){r(this,t),this.label=e}return a(t,[{key:"log",value:function(){this.doLog()&&console.log.apply(console,arguments)}},{key:"warn",value:function(){this.doLog()&&console.warn.apply(console,arguments)}},{key:"info",value:function(){this.doLog()&&console.info.apply(console,arguments)}},{key:"error",value:function(){this.doLog()&&console.error.apply(console,arguments)}},{key:"doLog",value:function(){return this.label||S}}]),t}(),L=new M,O=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._startTime=i(t,"startTime",(new Date).getTime()),n._timeScale=i(t,"scale",1),n._currentTime=(new Date).getTime(),n._deltaTime=0,n}return u(e,t),a(e,[{key:"on",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),this.reset()}},{key:"reset",value:function(){this._startTime=(new Date).getTime()}},{key:"update",value:function(){if(this.getStatus()){var t=this._currentTime;this._currentTime=(new Date).getTime(),this._deltaTime=(this._currentTime-t)/1e3*this._timeScale}}},{key:"getAbsoluteDelta",value:function(){return this._currentTime-this._startTime}},{key:"setTimeScale",value:function(t){this._timeScale=t}},{key:"getTimeScale",value:function(){return this._timeScale}},{key:"getDelta",value:function(){return this._deltaTime}},{key:"getTime",value:function(){return this._currentTime}}]),e}(g),R="start",P="update",E="restart",z="stop",F="resume",D="finish",A=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n._target=t.target,n._from=i(t,"from",null),n._to=t.to,n._duration=t.duration,n._easing=i(t,"easing",e.Easing.linear),n._repeat=i(t,"repeat",0),n._yoyo=i(t,"yoyo",!1),n._delay=i(t,"delay",0),n._time=new O,n._timesPlayed=0,n._direction=1;var o=i(t,"onStart",null),s=i(t,"onUpdate",null),a=i(t,"onRestart",null),h=i(t,"onStop",null),u=i(t,"onResume",null),c=i(t,"onFinish",null);return o&&n.events.on(R,o),s&&n.events.on(P,s),a&&n.events.on(E,a),h&&n.events.on(z,h),u&&n.events.on(F,u),c&&n.events.on(D,c),n}return u(e,t),a(e,[{key:"setup",value:function(){this.getContext().addComponent(this._time),this._time.setup(),this._time.on(),this._isPlaying=!1}},{key:"play",value:function(){if(this._isPlaying=!0,this._time.reset(),!this._from){this._from={};for(var t in this._to)this._from[t]=this._target[t]}this.events.trigger(R,this._target)}},{key:"stop",value:function(){this._isPlaying=!1,this.events.trigger(z,this._target)}},{key:"resume",value:function(){}},{key:"rewind",value:function(){this.update(0)}},{key:"update",value:function(t){if(this._isPlaying){var e=(void 0!==t?t:this._time.getAbsoluteDelta())/this._duration;if(e>=1){for(var i in this._from)this._target[i]=this._to[i];this._timesPlayed++<this._repeat?(this._yoyo&&(this._direction*=-1),this._time.reset(),this.events.trigger(E,this._target,this._direction)):(this._isPlaying=!1,this.events.trigger(D,this._target))}else{for(var n in this._from)this._direction<1?this._target[n]=T.map(this._easing(e),0,1,this._to[n],this._from[n]):this._target[n]=T.map(this._easing(e),0,1,this._from[n],this._to[n]);this.events.trigger(P,this._target)}}}},{key:"chain",value:function(t){this.events.on(D,function(){t.play()})}}]),e}(g);A.Easing={linear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return 1-Math.abs(Math.pow(t-1,2))},easeInOutQuad:function(t){return t<.5?A.Easing.easeInQuad(2*t)/2:A.Easing.easeOutQuad(2*t-1)/2+.5},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return 1-Math.abs(Math.pow(t-1,3))},easeInOutCubic:function(t){return t<.5?A.Easing.easeInCubic(2*t)/2:A.Easing.easeOutCubic(2*t-1)/2+.5},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return 1-Math.abs(Math.pow(t-1,4))},easeInOutQuart:function(t){return t<.5?A.Easing.easeInQuart(2*t)/2:A.Easing.easeOutQuart(2*t-1)/2+.5},easeInQuint:function(t){return Math.pow(t,5)},easeOutQuint:function(t){return 1-Math.abs(Math.pow(t-1,5))},easeInOutQuint:function(t){return t<.5?A.Easing.easeInQuint(2*t)/2:A.Easing.easeOutQuint(2*t-1)/2+.5},easeInSin:function(t){return 1+Math.sin(Math.PI/2*t-Math.PI/2)},easeOutSin:function(t){return Math.sin(Math.PI/2*t)},easeInOutSin:function(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2},easeInElastic:function(t){return(.04-.04/t)*Math.sin(25*t)+1},easeOutElastic:function(t){return.04*t/--t*Math.sin(25*t)},easeInOutElastic:function(t){return(t-=.5)<0?(.01+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1},easeInBounce:function(t){return 1-A.Easing.easeOutBounce(1-t)},easeOutBounce:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:function(t){return t<.5?.5*A.Easing.easeInBounce(2*t):.5*A.Easing.easeOutBounce(2*t-1)+.5}};var B=function(){function t(e){switch(r(this,t),e.type=i(e,"type","default"),this.texture=void 0,e.type){case"basic":this._material=new THREE.MeshBasicMaterial({color:16777215,wireframe:!1});break;case"custom":this._material=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms});break;case"projectionmapping":var n=THREE.ShaderLib.cube,o=THREE.UniformsUtils.clone(n.uniforms);n.vertexShader=n.vertexShader.replace("vWorldPosition = transformDirection( position, modelMatrix );","vWorldPosition = (modelMatrix * vec4( position, 0.0 )).xyz;"),n.fragmentShader=n.fragmentShader.replace("gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","vec3 viewDir = vWorldPosition-viewPosition;  gl_FragColor = textureCube( tCube, normalize(viewDir));"),n.fragmentShader=n.fragmentShader.replace("uniform samplerCube tCube;","uniform samplerCube tCube; uniform vec3 viewPosition;"),o.viewPosition={type:"v3",value:new THREE.Vector3(0,0,0)},this._material=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o});break;case"lambert":this._material=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,shading:THREE.FlatShading});break;case"default":case"phong":this._material=new THREE.MeshPhongMaterial({color:16777215}),this._material.shading=THREE.SmoothShading;break;case"line":this._material=new THREE.LineBasicMaterial({color:16777215});break;case"sprite":this._material=new THREE.SpriteMaterial({color:16777215});break;default:this._material=new THREE.MeshBasicMaterial({color:16777215,wireframe:!1})}this._material.side=THREE.DoubleSide,this.type=e.type}return a(t,[{key:"setTexture",value:function(t){this.texture=t,void 0!==this.texture._texture?this._material.map=this.texture._texture:void 0!==t.cube&&("projectionmapping"===this.type?this._material.uniforms.tCube.value=t.cube:this._material.envMap=t.cube)}},{key:"getTexture",value:function(){return this.texture}},{key:"setUniform",value:function(t,e){this._material.uniforms[t].value=e}},{key:"setTransparent",value:function(t){this._material.transparent=t}},{key:"getTransparent",value:function(){return this._material.transparent}},{key:"setColor",value:function(t){this._material.color=t}},{key:"getColor",value:function(){return this._material.color}},{key:"setWireframe",value:function(t){this._material.wireframe=t}},{key:"getWireframe",value:function(){return this._material.wireframe}},{key:"setOpacity",value:function(t){this._material.opacity=t}},{key:"getOpacity",value:function(){return this._material.opacity}},{key:"setDoubleSided",value:function(t){this._material.side=t?THREE.DoubleSide:THREE.FrontSide}},{key:"getDoubleSided",value:function(){return this._material.side===THREE.DoubleSide}},{key:"setAlphaTest",value:function(t){this._material.alphaTest=t}},{key:"getAlphaTest",value:function(){return this._material.alphaTest}},{key:"setDepthWrite",value:function(t){this._material.depthWrite=t}},{key:"setDepthTest",value:function(t){this._material.depthTest=t}},{key:"setLineWidth",value:function(t){this._material.linewidth=t}},{key:"getLineWidth",value:function(){return this._material.linewidth}},{key:"setShininess",value:function(t){this._material.shininess=t}},{key:"getShininess",value:function(){return this._material.shininess}},{key:"setEmissiveColor",value:function(t){this._material.emissive=t}},{key:"getEmissiveColor",value:function(){return this._material.emissive}},{key:"setShading",value:function(t){this._material.shading="smooth"===t?THREE.SmoothShading:THREE.FlatShading,this._material.needsUpdate=!0}},{key:"setSpecularColor",value:function(t){this._material.specular=t}},{key:"getSpecularColor",value:function(){return this._material.specular}},{key:"setProperty",value:function(t,e){this._material.uniforms[t].value=e}},{key:"getProperty",value:function(t){return this._material.uniforms[t].value}},{key:"setBlending",value:function(t){this._material.blending=t}},{key:"erase",value:function(){this._material.map&&this._material.map.dispose(),this._material.dispose()}}]),t}(),I=function(){function t(e){r(this,t),this.context=i(e,"context",null),this.type=i(e,"type","perspective"),this.fov=i(e,"fov",35),this.cubeResolution=i(e,"cubeResolution",1024),this.near=i(e,"near",.1),this.far=i(e,"far",5e3);var n=i(e,"position",void 0);if("perspective"===this.type){if(this.context){var s=this.context.getCanvasSize();L.log("camera canvasSize",s),this._camera=new THREE.PerspectiveCamera(this.fov,s.width/s.height,this.near,this.far)}else this._camera=new THREE.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,this.near,this.far);L.log("made perspective cam")}else if("ortho"===this.type){if(this.context){var a=this.context.getCanvasSize();this._camera=new THREE.OrthographicCamera(a.width/-2,a.width/2,a.height/2,a.height/-2,this.near,this.far)}else this._camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,this.near,this.far);this._camera.position.z=400,L.log("made ortho cam")}else"cube"===this.type&&(this._camera=new THREE.CubeCamera(.5,1e3,this.cubeResolution),L.log("made cube cam"));this.transform=new X(this),void 0!==n&&this.transform.setLocalPosition(n),this.viewport=o(e,"viewport",w,0,0,1,1),this.layer=i(e,"layer","default"),this.verticalshift=i(e,"verticalshift",0),this.horizontalshift=i(e,"horizontalshift",0),this.autorender=i(e,"autorender",!0),this.autoclear=i(e,"autoclear",!0),this.autoupdatematrix=i(e,"autoupdatematrix",!1),this.dirty=!1}return a(t,[{key:"setRenderTexture",value:function(t){this.renderTexture=t}},{key:"setFOV",value:function(t){this.fov=t,"perspective"===this.type&&(this._camera.fov=this.fov,this.updateProjectionMatrix())}},{key:"getFOV",value:function(){return this.fov}},{key:"setClearColor",value:function(t){this.clearColor=t}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setAutorender",value:function(t){this.autorender=t}},{key:"lookAt",value:function(t){this._camera.lookAt(t)}},{key:"setAspect",value:function(t){this._camera.aspect=t,this.updateProjectionMatrix()}},{key:"setVerticalShift",value:function(t){this.verticalshift=t,this.updateProjectionMatrix()}},{key:"setHorizontalShift",value:function(t){this.horizontalshift=t,this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var t=1/this._camera.aspect;"cube"!==this.type&&("ortho"!==this.type&&this._camera.setViewOffset(1,t,1*this.horizontalshift,t*this.verticalshift,1,t),this.autoupdatematrix&&this._camera.updateProjectionMatrix())}},{key:"getAspect",value:function(){return this._camera.aspect}},{key:"setOrthoPlanes",value:function(t,e,i,n){"ortho"===this.type?(this._camera.left=t,this._camera.right=e,this._camera.top=i,this._camera.bottom=n):console.warn("setOrthoBounds() can't be used on perspective cams!")}},{key:"setZoom",value:function(t){"ortho"===this.type?this._camera.zoom=t:console.warn("setZoom() can't be used on perspective cams!")}},{key:"getZoom",value:function(){if("ortho"===this.type)return this._camera.zoom;console.warn("getZoom() can't be used on perspective cams!")}},{key:"setFarPlane",value:function(t){"cube"!==this.type?(this._camera.far=t,this.updateProjectionMatrix()):"cube"===this.type&&this._camera.children.forEach(function(e){e.far=t,e.updateProjectionMatrix()})}},{key:"getFarPlane",value:function(){return this._camera.far}},{key:"setNearPlane",value:function(t){"cube"!==this.type?(this._camera.near=t,this.updateProjectionMatrix()):"cube"===this.type&&this._camera.children.forEach(function(e){e.near=t,e.updateProjectionMatrix()})}},{key:"getNearPlane",value:function(){return this._camera.near}},{key:"setPlanes",value:function(t,e){this._camera.far=e,this._camera.near=t,this.updateProjectionMatrix()}},{key:"setToPixel",value:function(){if("perspective"===this.type){var t;if(this.context){var e=this.context.getCanvasSize();t=new C(e.width/2,-e.height/2,1/(2*Math.tan(T.degToRad(this.fov/2)/e.height)))}else t=new C(window.innerWidth/2,-window.innerHeight/2,1/(2*Math.tan(T.degToRad(this.fov/2)/window.innerHeight)));this.transform.setLocalPosition(t)}else console.error("only perspective camera can be setted to screen pixel z position")}},{key:"perspectiveOffCenter",value:function(t,e,i,n,o,s){var r=2*o/(e-t),a=2*o/(n-i),h=(e+t)/(e-t),u=(n+i)/(n-i),l=-(s+o)/(s-o),c=-2*s*o/(s-o);this._camera.projectionMatrix.set(r,0,h,0,0,a,u,0,0,0,l,c,0,0,-1,0)}},{key:"aspect",set:function(t){this.setAspect(t)},get:function(){this.getAspect()}},{key:"zoom",set:function(t){this.setZoom(t)},get:function(){this.getZoom()}},{key:"farPlane",set:function(t){this.setFarPlane(t)},get:function(){return this.setFarPlane}},{key:"nearPlane",set:function(t){this.setNearPlane(t)},get:function(){return this.getNearPlane()}}]),t}(),W=function(){function t(e){switch(r(this,t),this.type=i(e,"type","point"),this.type){case"point":this.light=new THREE.PointLight(16777215),this.light.distance=1e3;break;case"directional":this.light=new THREE.DirectionalLight(16777215),this.light.position.set(1,1,1).normalize();break;case"ambient":this.light=new THREE.AmbientLight(4210752),this.light.position.set(1,1,1).normalize();break;case"spot":this.light=new THREE.SpotLight(16777215),this.target=new THREE.Object3D,this.light.target=this.target;break;default:this.light=new THREE.PointLight(16777215),this.type="point"}this.light.intensity=i(e,"intensity",1),this.light.distance=i(e,"distance",5e3),this.light.color=i(e,"color",p.white),this.transform=new X(this)}return a(t,[{key:"setIntensity",value:function(t){this.light.intensity=t}},{key:"getIntensity",value:function(t){return this.light.intensity}},{key:"setDistance",value:function(t){"point"!==this.type&&"spot"!==this.type||(this.light.distance=t)}},{key:"getDistance",value:function(){return this.light.distance}},{key:"setColor",value:function(t){this.light.color=t}},{key:"getColor",value:function(){return this.light.color}},{key:"setAngle",value:function(t){"spot"===this.type&&(this.light.angle=t)}},{key:"getAngle",value:function(){return this.light.angle}},{key:"setTargetPosition",value:function(t,e,i){"spot"===this.type&&(t instanceof C?(this.target.position.set(t.x,t.y,t.z),this.target.updateMatrixWorld()):(this.target.position.set(t,e,i),this.target.updateMatrixWorld()))}},{key:"setPenumbra",value:function(t){this.light.penumbra=t}},{key:"setCastShadow",value:function(t){this.light.castShadow=t}},{key:"setShadowSize",value:function(t,e){this.light.shadow.mapSize.width=t,this.light.shadow.mapSize.height=e}},{key:"setShadowDistance",value:function(t,e){this.light.shadow.camera.near=t,this.light.shadow.camera.far=e}}]),t}(),U=function(){function t(e){r(this,t),this._texture,this._image=i(e,"image",void 0),this._canvas=i(e,"canvas",void 0),this._image?this.fromImage(this._image):this._canvas&&this.fromCanvas(this._canvas)}return a(t,[{key:"fromImage",value:function(t){this._texture=new e.Texture(t),this._texture.needsUpdate=!0,this.width=t.width,this.height=t.height}},{key:"fromCanvas",value:function(t){var i=this;this._texture=new e.Texture(t),this._texture.needsUpdate=!0,this._texture.magFilter=e.LinearFilter,this._texture.minFilter=e.LinearFilter,this.width=this._texture.image.width,this.height=this._texture.image.height,t.events&&t.events.on("drawn",function(){i.setNeedsUpdate(!0)})}},{key:"dispose",value:function(){this._texture.dispose()}},{key:"setRepeat",value:function(t,i){this._texture&&void 0!==this._texture&&(this._texture.repeat.set(t,i),this._texture.wrapS=e.RepeatWrapping,this._texture.wrapT=e.RepeatWrapping)}},{key:"setOffset",value:function(t){this._texture.offset=t}},{key:"setNeedsUpdate",value:function(){this._texture.needsUpdate=!0}},{key:"setPremultiplyAlpha",value:function(t){this._texture.premultiplyAlpha=t}},{key:"setMapping",value:function(t){this._texture.mapping=t}}]),t}();U.UVMapping=e.UVMapping,U.CubeReflectionMapping=e.CubeReflectionMapping,U.CubeRefractionMapping=e.CubeRefractionMapping,U.EquirectangularReflectionMapping=e.EquirectangularReflectionMapping,U.EquirectangularRefractionMapping=e.EquirectangularRefractionMapping,U.SphericalReflectionMapping=e.SphericalReflectionMapping,U.CubeUVReflectionMapping=e.CubeUVReflectionMapping,U.CubeUVRefractionMapping=e.CubeUVRefractionMapping;var j=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.setName(i(t,"name",void 0)),n.font=i(t,"font",null),n.material=i(t,"material","basic"),n._text=i(t,"text",""),n._lineMaxCharCount=i(t,"lineMaxCharCount",40),n.style=new Style,n._width=i(t,"width",100),n._height=i(t,"height",100),n.style.color=i(t,"color",p.white),n.style.fontSize=i(t,"fontSize",72),n.style.textAlign=i(t,"textAlign","center"),n.mesh=new N({primitive:"plane",width:1,height:1,material:n.material}),void 0!==t.backgroundColor?(n.style.hasBackground=!0,n.style.backgroundColor=t.backgroundColor):n.style.hasBackground=!1,n.transform=new X(n),n.transform.setLocalScale(n._width,n._height),n.needsComputeTextSize=!0,n.precLine=i(t,"precLine",""),n._textSize=0,void 0!==t.texture?(n.material.setTexture(t.texture),n.transform.setLocalScale(t.width,t.height,1)):n.render(),n}return u(e,t),a(e,[{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"setBackgroundTexture",value:function(t){this.style.backgroundTexture=t}},{key:"setText",value:function(t){this._text=t,this.render()}},{key:"setNeedsComputeTextSize",value:function(t){this.needsComputeTextSize=t}},{key:"setShadowColor",value:function(t){this.shadowColor="rgba("+t.r+","+t.g+","+t.b+",1)"}},{key:"setShadowBlur",value:function(t){this.shadowBlur=t}},{key:"render",value:function(){void 0===this._text&&(this._text=""),void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.retinaResolutionEnabled=!1),this._width>2048&&(this._width=2048),this._height>2048&&(this._height=2048),this._canvas.width=this._width,this._canvas.height=this._height;var t=this._canvas.getContext("2d");if(t.fillStyle=this.style.backgroundColor.makeRGBAStringWithAlpha(this.style.backgroundColorAlpha),t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,void 0!==this.style.backgroundTexture?t.drawImage(this.style.backgroundTexture.texture.image,0,0,this._width,this._height):this.style.hasBackground?t.fillRect(0,0,this._canvas.width,this._canvas.height):t.clearRect(0,0,this._canvas.width,this._canvas.height),void 0!==this.font&&null!==this.font){L.log("render label with font",this.font);for(var e="",i="",n=this._lineMaxCharCount,o=0;o<this._text.length;++o){var s=this._text[o];"\n"===s||" "===s?(i.length+1>n?(e+="\n",e+=i+" ",n=this._lineMaxCharCount-(i.length+1),"\n"===s&&(e+="\n",n=this._lineMaxCharCount)):"\n"===s?(e+=i,e+="\n",n=this._lineMaxCharCount):(e+=i+" ",n-=i.length+1),i=""):i+=s}i.length+1>n&&(e+="\n"),e+=i;var r,a=e.split("\n"),h=0,u=0;0===a.length?(a.push(e),this.lastLine=e):this.lastLine=a[a.length-1],this.nbLines=a.length;for(var l in a){var c=a[l];if(this.needsComputeTextSize){this._textSize=this.font.getTextSize(c,this.style.fontSize),"center"===this.style.textAlign?h=this._width/2-this._textSize.width/2:"end"===this.style.textAlign||"right"===this.style.textAlign?h=this._width-this._textSize.width:"left"!==this.style.textAlign&&"start"!==this.style.textAlign||(h=0===l?this.font.getTextSize(this.precLine,this.style.fontSize).width+this.style.textHorizontalMargin:0+this.style.textHorizontalMargin);var d=0;"center"===this.style.textVerticalAlign?(a.length>1&&(d=l-(a.length-1)/2),u=this._height/2+this._textSize.height/2+d*this.style.fontSize):"top"===this.style.textVerticalAlign?(d=l,u=this.style.fontSize+d*this.style.fontSize+this.style.textVerticalMargin):"bottom"===this.style.textVerticalAlign&&(d=l,u=d*this.style.fontSize),this.cursorx=h+this._textSize.width,this.cursory=u}r=this.font.getFont().getPath(c,h,u,this.style.fontSize),r.fill="#"+this.style.color.getHexString(),r.draw(t)}}this._texture?this._texture.dispose():this._texture=new U({canvas:this._canvas}),this._texture.fromCanvas(this._canvas),this.mesh.material.setTexture(this._texture)}},{key:"createTextLabel",value:function(t,i,n,o,s,r,a,h,u){var l=new e(t,i,s,r);return l.style.fontSize=n,l.style.color=a,void 0!==h?(l.style.hasBackground=!0,l.style.backgroundColor=h):l.style.hasBackground=!1,l.style.textAlign=o,void 0!==u?(l.material.setTexture(u),l.transform.setLocalScale(s,r,1)):l.render(),l}}]),e}(f),X=function(){function t(e){r(this,t),this.mobObject=e,e instanceof N?this.entity=e.mesh:e instanceof I?this.entity=e._camera:e instanceof W?this.entity=e.light:e instanceof j&&(this.entity=e.mesh.mesh),this.children=[]}return a(t,[{key:"lookAt",value:function(t){this.entity.lookAt(t)}},{key:"setLocalQuaternion",value:function(t){t instanceof k&&this.entity.quaternion.set(t.x,t.y,t.z,t.w)}},{key:"getLocalQuaternion",value:function(){
return new k(this.entity.quaternion.x,this.entity.quaternion.y,this.entity.quaternion.z,this.entity.quaternion.w)}},{key:"setLocalMatrix",value:function(t){this.entity.matrixAutoUpdate=!1;var e=(new x).multiplyMatrices(this.entity.matrix,t);this.entity.applyMatrix(e),this.entity.updateMatrix()}},{key:"setLocalEulerAngles",value:function(t,e,i){3===arguments.length?(this.entity.rotation.x=T.degToRad(t),this.entity.rotation.y=T.degToRad(e),this.entity.rotation.z=T.degToRad(i)):2===arguments.length?"number"==typeof t&&"number"==typeof e&&(this.entity.rotation.x=T.degToRad(t),this.entity.rotation.y=T.degToRad(e)):1===arguments.length&&(t instanceof C&&(this.entity.rotation.x=T.degToRad(t.x),this.entity.rotation.y=T.degToRad(t.y),this.entity.rotation.z=T.degToRad(t.z)),t instanceof b?(this.entity.rotation.x=T.degToRad(t.x),this.entity.rotation.y=T.degToRad(t.y)):"number"==typeof t&&(this.entity.rotation.z=T.degToRad(t)))}},{key:"getLocalEulerAngles",value:function(){return new C(T.radToDeg(this.entity.rotation.x)%360,T.radToDeg(this.entity.rotation.y)%360,T.radToDeg(this.entity.rotation.z)%360)}},{key:"setLocalRotation",value:function(){this.setLocalEulerAngles.apply(this,arguments)}},{key:"setLocalRotationX",value:function(t){"number"==typeof t&&(this.entity.rotation.x=T.degToRad(t))}},{key:"setLocalRotationY",value:function(t){"number"==typeof t&&(this.entity.rotation.y=T.degToRad(t))}},{key:"setLocalRotationZ",value:function(t){"number"==typeof t&&(this.entity.rotation.z=T.degToRad(t))}},{key:"getLocalRotation",value:function(){return this.getLocalEulerAngles()}},{key:"getLocalRotationX",value:function(){return this.getLocalEulerAngles().x}},{key:"getLocalRotationY",value:function(){return this.getLocalEulerAngles().y}},{key:"getLocalRotationZ",value:function(){return this.getLocalEulerAngles().z}},{key:"setLocalPosition",value:function(t,e,i){3===arguments.length?(this.entity.position.x=t,this.entity.position.y=e,this.entity.position.z=i):2===arguments.length?"number"==typeof t&&"number"==typeof e&&(this.entity.position.x=t,this.entity.position.y=e):1===arguments.length&&(t instanceof C?(this.entity.position.x=t.x,this.entity.position.y=t.y,this.entity.position.z=t.z):t instanceof b?(this.entity.position.x=t.x,this.entity.position.y=t.y):"number"==typeof t&&(this.entity.position.x=t,this.entity.position.y=t,this.entity.position.z=t))}},{key:"setLocalPositionX",value:function(t){"number"==typeof t&&(this.entity.position.x=t)}},{key:"setLocalPositionY",value:function(t){"number"==typeof t&&(this.entity.position.y=t)}},{key:"setLocalPositionZ",value:function(t){"number"==typeof t&&(this.entity.position.z=t)}},{key:"getLocalPosition",value:function(){return new C(this.entity.position.x,this.entity.position.y,this.entity.position.z)}},{key:"getLocalPositionX",value:function(){return this.entity.position.x}},{key:"getLocalPositionY",value:function(){return this.entity.position.y}},{key:"getLocalPositionZ",value:function(){return this.entity.position.z}},{key:"getWorldPosition",value:function(){var t=new C;return t.setFromMatrixPosition(this.entity.matrixWorld),t}},{key:"setLocalScale",value:function(t,e,i){3===arguments.length?(this.entity.scale.x=t,this.entity.scale.y=e,this.entity.scale.z=i):2===arguments.length?"number"==typeof t&&"number"==typeof e&&(this.entity.scale.x=t,this.entity.scale.y=e):1===arguments.length&&(t instanceof C?(this.entity.scale.x=t.x,this.entity.scale.y=t.y,this.entity.scale.z=t.z):t instanceof b?(this.entity.scale.x=t.x,this.entity.scale.y=t.y):"number"==typeof t&&(this.entity.scale.x=t,this.entity.scale.y=t,this.entity.scale.z=t))}},{key:"setLocalScaleX",value:function(t){"number"==typeof t&&(this.entity.scale.x=t)}},{key:"setLocalScaleY",value:function(t){"number"==typeof t&&(this.entity.scale.y=t)}},{key:"setLocalScaleZ",value:function(t){"number"==typeof t&&(this.entity.scale.z=t)}},{key:"getLocalScale",value:function(){return new C(this.entity.scale.x,this.entity.scale.y,this.entity.scale.z)}},{key:"getLocalScaleX",value:function(){return this.entity.scale.x}},{key:"getLocalScaleY",value:function(){return this.entity.scale.y}},{key:"getLocalScaleZ",value:function(){return this.entity.scale.z}},{key:"pick",value:function(t,e,i){[].push(this.entity);var n=0,o=0;if(t.context){var s=t.context.getCanvasSize();n=e/s.width*2-1,o=-i/s.height*2+1}else n=e/window.innerWidth*2-1,o=-i/window.innerHeight*2+1;var r=new THREE.Raycaster,a=new THREE.Vector3(n,o,1),h=t.transform.entity,u=(r.setFromCamera(a,h),r.intersectObjects([this.entity]));if(u.length>0){var l={};return l.point=u[0].point,l.uv=u[0].uv,l.distance=u[0].distance,l}return null}},{key:"getScreenCoordinates",value:function(t,e){if("perspective"===e.type){var i=new C,n=.5*t.getCanvasSize().width*e.viewport.width,o=.5*t.getCanvasSize().height*e.viewport.height;return this.entity.updateMatrixWorld(),i.setFromMatrixPosition(this.entity.matrixWorld),i.project(e.camera),i.x=i.x*n+n,i.y=-i.y*o+o,{x:i.x,y:i.y}}}},{key:"addChild",value:function(t){this.children.push(t.mobObject),this.entity.add(t.entity)}},{key:"removeChild",value:function(t){this.children.splice(this.children.indexOf(t),1),this.entity.remove(t.entity)}},{key:"getChildren",value:function(){return this.children}},{key:"getChild",value:function(t){return this.children[t]}},{key:"setRenderOrder",value:function(t){this.entity.renderOrder=t}},{key:"setVisible",value:function(t){this.entity.visible=t}},{key:"getVisible",value:function(){return this.entity.visible}}]),t}(),N=function(){function t(e){switch(r(this,t),this.primitive=i(e,"primitive","box"),this.name=i(e,"name",void 0),this.material=i(e,"material","phong"),this._geometry=i(e,"geometry",void 0),this.visible=!0,this.primitive){case"plane":this.constructPlane(e);break;case"quad":this.constructQuad(e);break;case"box":this.constructBox(e);break;case"cube":this.constructCube(e);break;case"sphere":this.constructSphere(e);break;case"circle":this.constructCircle(e);break;case"cylinder":this.constructCylinder(e);break;case"icosahedron":this.constructIcosahedron(e);break;case"octahedron":this.constructOctahedron(e);break;case"text":this.constructText(e);break;case"node":this.constructNode();break;case"line":this.constructLine(e);break;case"sprite":this.constructSprite();break;case"arc":this.constructArc(e);break;case"custom":this.constructCustom(e);break;default:this.constructNode()}this.transform||(this.transform=new X(this))}return a(t,[{key:"constructNode",value:function(){this.mesh=new e.Object3D}},{key:"constructLine",value:function(t){this._geometry=new e.Geometry,this._geometry.dynamic=!0;var n=i(t,"point1",new C(0,-1,0)),o=i(t,"point2",new C(0,1,0));console.log(n,o),this._geometry.vertices.push(n,o),this.material=new B({type:"line"}),this.mesh=new e.Line(this._geometry,this.material._material)}},{key:"constructSprite",value:function(){this.material=new B({type:"sprite"}),this.mesh=new e.Sprite(this.material._material)}},{key:"constructPlane",value:function(t){var n=i(t,"width",1),o=i(t,"height",1),s=i(t,"segments",1),r=i(t,"widthSegments",s),a=i(t,"heightSegments",s);this._geometry=new e.PlaneBufferGeometry(n,o,r,a),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructQuad",value:function(t){var n=i(t,"point1",new b(-1,1)),o=i(t,"point2",new b(1,1)),s=i(t,"point3",new b(1,-1)),r=i(t,"point4",new b(-1,-1)),a=new e.Shape;a.moveTo(n.x,n.y),a.lineTo(o.x,o.y),a.lineTo(s.x,s.y),a.lineTo(r.x,r.y),a.lineTo(n.x,n.y),this._geometry=new e.ShapeGeometry(a),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructCube",value:function(t){var n=i(t,"size",1),o=i(t,"segments",1),s=i(t,"widthSegments",o),r=i(t,"heightSegments",o),a=i(t,"depthSegments",o);this._geometry=new e.BoxGeometry(n,n,n,s,r,a),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructBox",value:function(t){var n=i(t,"width",1),o=i(t,"height",1),s=i(t,"depth",1),r=(i(t,"segments",1),i(t,"widthSegments",1)),a=i(t,"heightSegments",1),h=i(t,"depthSegments",1);this._geometry=new e.BoxGeometry(n,o,s,r,a,h),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructSphere",value:function(t){var n=i(t,"radius",1),o=i(t,"segments",8),s=i(t,"widthSegments",o),r=i(t,"heightSegments",o),a=i(t,"phiStart",0),h=i(t,"phiLength",2*Math.PI),u=i(t,"thetaStart",0),l=i(t,"thetaLength",Math.PI);this._geometry=new e.SphereGeometry(n,s,r,a,h,u,l),this._geometry.dynamic=!0,this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructCircle",value:function(t){var n=i(t,"radius",1),o=i(t,"segments",32),s=i(t,"thetaStart",0),r=i(t,"thetaLength",2*Math.PI);this._geometry=new e.CircleGeometry(n,o,s,r),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructCylinder",value:function(t){var n=i(t,"radiusTop",1),o=i(t,"radiusBottom",1),s=i(t,"height",1),r=i(t,"radiusSegments",32),a=i(t,"heightSegments",1),h=i(t,"openEnded",!1),u=i(t,"thetaStart",0),l=i(t,"thetaLength",2*Math.PI);this._geometry=new e.CylinderGeometry(n,o,s,r,a,h,u,l),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructIcosahedron",value:function(t){var n=i(t,"radius",1),o=i(t,"detail",0);this._geometry=new e.IcosahedronGeometry(n,o),this._geometry.dynamic=!0,this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructOctahedron",value:function(t){var n=i(t,"radius",1),o=i(t,"detail",0);this._geometry=new e.OctahedronGeometry(n,o),this._geometry.dynamic=!0,this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructText",value:function(t){var n=i(t,"text","text"),o=i(t,"fontSize",1),s=i(t,"height",1),r=i(t,"segments",5),a=i(t,"font",void 0),h=new e.Font(a);console.log(h),this._geometry=new e.TextGeometry(n,{size:o,height:s,curveSegments:r,font:h,weight:"normal",style:"normal",bevelEnabled:!1}),this._geometry.center(),this.attachMaterial(this.material),this.mesh=new e.Mesh(this._geometry,this.material._material)}},{key:"constructArc",value:function(t){this._geometry=new e.Geometry,this._geometry.dynamic=!0;var n=i(t,"radius",1),o=i(t,"width",.2),s=i(t,"segments",32),r=i(t,"startAngle",0),a=i(t,"endAngle",2*Math.PI),h=i(t,"color",p.white.clone()),u=t.texture,l=t.uvScale,c=i(t,"center",C.zero.clone());this.createArc({center:c,radius:n,segments:s,startAngle:r,endAngle:a,color:h,texture:u,width:o,uvScale:l})}},{key:"constructCustom",value:function(t){this._geometry=i(t,"geometry",new e.Geometry),this._geometry.dynamic=!0}},{key:"generateFillMesh",value:function(t){var i=new e.Shape;i.moveTo(t[0].x,t[0].y);for(var n=1;n<t.length;n++)i.lineTo(t[n].x,t[n].y);i.closePath();var o=new e.ShapeGeometry(i);this._geometry=o,this.constructMesh(),this.generateFlatUVs()}},{key:"generateFlatUVs",value:function(){for(var t=this._geometry,e=[],i=this.getBoundingBox(),n=0;n<t.faces.length;n++){var o=t.faces[n];e[n]=[new b(T.map(t.vertices[o.a].x,i.min.x,i.max.x,0,1),T.map(t.vertices[o.a].y,i.min.y,i.max.y,0,1)),new b(T.map(t.vertices[o.b].x,i.min.x,i.max.x,0,1),T.map(t.vertices[o.b].y,i.min.y,i.max.y,0,1)),new b(T.map(t.vertices[o.c].x,i.min.x,i.max.x,0,1),T.map(t.vertices[o.c].y,i.min.y,i.max.y,0,1))]}this.setUVs(0,e)}},{key:"updateStroke",value:function(i,n){var o=t.generateStrokeShape(i,n),s=new e.ShapeGeometry(o);this.setVertices(s.vertices),this.updateMesh()}},{key:"getBoundingBox",value:function(){return this._geometry?(this._geometry.boundingBox||this._geometry.computeBoundingBox(),this._geometry.boundingBox):(new e.Box3).setFromObject(this.mesh)}},{key:"getBoundingSphere",value:function(){return this._geometry?(this._geometry.boundingSphere||this._geometry.computeBoundingSphere(),this._geometry.boundingSphere):(new e.Box3).setFromObject(this.mesh).getBoundingSphere()}},{key:"createLine",value:function(t,i,n,o,s,r){var a=C.zero,h=C.zero;h.subVectors(i,t),void 0===r&&(r=h.length()),h.normalize(),a.crossVectors(h,new C(0,0,1)),a.x*=s,a.y*=s,a.z*=s;var u=new C(t.x-a.x,t.y-a.y,t.z-a.z),l=new C(t.x+a.x,t.y+a.y,t.z+a.z),c=new C(i.x+a.x,i.y+a.y,i.z+a.z),d=new C(i.x-a.x,i.y-a.y,i.z-a.z);this.transform.setLocalPosition(C.zero.clone());var f=new e.Vector2(0,r),v=new e.Vector2(1,r),g=new e.Vector2(1,0),y=new e.Vector2(0,0);this.pushQuad(u,l,c,d,f,v,g,y),this.material.setColor(n),this.material.setWireframe(!1)}},{key:"createCircle",value:function(t){var e=i(t,"center",new C(0,0,0)),n=i(t,"radius",1),o=i(t,"segments",32);i(t,"color"),i(t,"width"),i(t,"uvScale",1);this.createArc({center:e,radius:n,segments:o,startAngle:0,endAngle:2*Math.PI,color:p.white.clone(),width:1,uvScale:1})}},{key:"createArc",value:function(t){var n=i(t,"center",new C(0,0,0)),o=i(t,"radius",1),s=i(t,"segments",32),r=i(t,"startAngle",0),a=i(t,"endAngle",2*Math.PI),h=i(t,"color",p.white.clone()),u=i(t,"width",1),l=i(t,"uvScale",1);void 0===l&&(l=o*(a-r)*1);var c=[],d=[],f=2*Math.PI/s,v=r,g=a,y=0;for(y=v;y<=g;y+=f)c.push(new C(Math.cos(y)*(o-u/2),Math.sin(y)*(o-u/2),0)),d.push(new C(Math.cos(y)*(o+u/2),Math.sin(y)*(o+u/2),0));y!==g&&(c.push(new C(Math.cos(a)*(o-u/2),Math.sin(a)*(o-u/2),0)),d.push(new C(Math.cos(a)*(o+u/2),Math.sin(a)*(o+u/2),0)));for(var m=0;m<c.length-1;++m){var _=d[m],x=c[m],k=c[(m+1)%c.length],w=d[(m+1)%c.length],T=new b(0,(m+0)*l/(c.length-1)),S=new b(1,(m+0)*l/(c.length-1)),M=new b(1,(m+1)*l/(c.length-1)),L=new b(0,(m+1)*l/(c.length-1));this.pushQuad(_,x,k,w,T,S,M,L)}this.material=new B({type:"basic"}),this.material.setColor(h),this.mesh=new e.Mesh(this._geometry,this.material._material),this.transform=new X(this),this.transform.setLocalPosition(n)}},{key:"createDisc",value:function(t,e,i,n,o){this.createDiscSector(t,e,i,0,2*Math.PI,n,o)}},{key:"createDiscSector",value:function(t){var n=i(t,"center",new C(0,0,0)),o=i(t,"radius",1),s=i(t,"segments",32),r=i(t,"startAngle",0),a=i(t,"endAngle",2*Math.PI),h=(i(t,"color",p.white.clone()),[]),u=2*Math.PI/s,l=r,c=a,d=0;for(d=l;d<=c;d+=u)h.push(new C(Math.cos(d)*o,Math.sin(d)*o,0));d!==c&&h.push(new C(Math.cos(a)*o,Math.sin(a)*o,0));for(var f=new C(0,0,0),v=0;v<h.length-1;++v){var g=h[v],y=h[v+1];this.pushTriangle(f,g,y);var m=new b(0,0),_=new b(1,0),x=new b(1,1);this.pushUV(m,_,x)}this.material=new B({type:"basic"}),this.mesh=new e.Mesh(this._geometry,this.material._material),this.transform=new X(this),this.transform.setLocalPosition(n)}},{key:"constructMesh",value:function(){this.material=new B({type:"basic"}),this.mesh=new e.Mesh(this._geometry,this.material._material),this.transform=new X(this),this._geometry.computeBoundingBox()}},{key:"pushVertex",value:function(t){this._geometry.vertices.push(t),this._geometry.verticesNeedUpdate=!0}},{key:"pushFace",value:function(t,i,n){this._geometry.faces.push(new e.Face3(t,i,n)),this._geometry.elementsNeedUpdate=!0}},{key:"pushUV",value:function(t,e,i){this._geometry.faceVertexUvs[0].push([t,e,i]),this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0}},{key:"pushNormal",value:function(t,e,i){this._geometry.faceVertexNormals[0].push([t,e,i]),this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.normalsNeedUpdate=!0}},{key:"pushTriangle",value:function(t,i,n){var o=this._geometry.vertices.length;this._geometry.vertices.push(t,i,n),this._geometry.faces.push(new e.Face3(o+0,o+1,o+2)),this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0}},{key:"pushQuad",value:function(t,i,n,o,s,r,a,h){var u=this._geometry.vertices.length;this._geometry.vertices.push(t,i,n,o),this._geometry.faces.push(new e.Face3(u+0,u+1,u+2)),this._geometry.faces.push(new e.Face3(u+0,u+2,u+3)),this._geometry.faceVertexUvs[0].push([s,r,a]),this._geometry.faceVertexUvs[0].push([s,a,h]),this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0}},{key:"computeNormals",value:function(){this._geometry.computeFaceNormals(),this._geometry.normalsNeedUpdate=!0,this._geometry.computeVertexNormals(!0),this._geometry.verticesNeedUpdate=!0}},{key:"updateMesh",value:function(){this._geometry.normalsNeedUpdate=!0,this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0}},{key:"clear",value:function(){this._geometry.vertices=[],this._geometry.faces=[],this._geometry.faceVertexUvs[0]=[],this._geometry.faceVertexNormals[0]=[],this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0}},{key:"erase",value:function(){this._geometry.dispose(),this.material.erase()}},{key:"setVertices",value:function(t){this._geometry.vertices=t,this._geometry.verticesNeedUpdate=!0,this._geometry.computeBoundingBox()}},{key:"getVertices",value:function(){return this._geometry.vertices}},{key:"setUVs",value:function(t,e){this._geometry.faceVertexUvs[t]=e,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0}},{key:"getUVs",value:function(t){return this._geometry.faceVertexUvs[t]}},{key:"setVertexColors",value:function(t){this.material._material.vertexColors=e.VertexColors,this._geometry.colors=t,this._geometry.colorsNeedUpdate=!0}},{key:"getVertexColors",value:function(){return this._geometry.colors}},{key:"setCenter",value:function(t,e,i){this._geometry.applyMatrix((new x).makeTranslation(t,e,i))}},{key:"getCenter",value:function(){return null===this._geometry.boundingBox&&this._geometry.computeBoundingBox(),this._geometry.boundingBox.center()}},{key:"setScale",value:function(t,e,i){3===arguments.length?this._geometry.applyMatrix((new x).makeScale(t,e,i)):2===arguments.length?"number"==typeof t&&"number"==typeof e&&this._geometry.applyMatrix((new x).makeScale(t,e,1)):1===arguments.length&&(t instanceof C?this._geometry.applyMatrix((new x).makeScale(t.x,t.y,t.z)):t instanceof b?this._geometry.applyMatrix((new x).makeScale(t.x,t.y,1)):"number"==typeof t&&this._geometry.applyMatrix((new x).makeScale(t,t,t)))}},{key:"setRotationX",value:function(t){this._geometry.applyMatrix((new x).makeRotationX(T.degToRad(t)))}},{key:"setRotationY",value:function(t){this._geometry.applyMatrix((new x).makeRotationY(T.degToRad(t)))}},{key:"setRotationZ",value:function(t){this._geometry.applyMatrix((new x).makeRotationZ(T.degToRad(t)))}},{key:"setVisible",value:function(t){this.mesh.visible=t}},{key:"getVisible",value:function(){return this.mesh.visible}},{key:"updateMaterial",value:function(){this.mesh.material&&(this.mesh.material=this.material._material)}},{key:"setMaterial",value:function(t){this.material=null,void 0===t?this.material=new B({type:"default"}):t instanceof B?this.material=t:"string"==typeof t&&(this.material=new B({type:t}));var i=new e.Mesh(this._geometry,this.material._material),n=this.transform;this.mesh=i,this.transform=new X(this),this.transform.setLocalScale(n.getLocalScale().x,n.getLocalScale().y,n.getLocalScale().z),this.transform.setLocalPosition(n.getLocalPosition().x,n.getLocalPosition().y,n.getLocalPosition().z),this.transform.setLocalRotation(n.getLocalRotation().x,n.getLocalRotation().y,n.getLocalRotation().z)}},{key:"attachMaterial",value:function(t){void 0===t?this.material=new B({type:"default"}):t instanceof B?this.material=t:"string"==typeof t&&(this.material=new B({type:t})),void 0!==t&&this.mesh&&this.updateMaterial()}},{key:"setCastShadow",value:function(t){this.mesh.castShadow=t}},{key:"setReceiveShadow",value:function(t){this.mesh.receiveShadow=t}}],[{key:"generateStrokeShape",value:function(i,n){for(var o=i._geometry.clone(),s=i._geometry.clone(),r=i._geometry.clone(),a=t.geometryIsCW(o)?"ccw":"cw",h=0;h<r.vertices.length;h++){var u=r.vertices[h>0?h-1:r.vertices.length-1],l=r.vertices[h],c=r.vertices[h<r.vertices.length-1?h+1:0],d=new b(l.x-u.x,l.y-u.y),f=new b(c.x-l.x,c.y-l.y);"ccw"===a?d.rotate90CCW():d.rotate90CW(),"ccw"===a?f.rotate90CCW():f.rotate90CW(),d.normalize(),f.normalize();var v=d.multiplyScalar(n).clone(),g=f.multiplyScalar(n).clone(),y={x:u.x+v.x,y:u.y+v.y},p={x:l.x+v.x,y:l.y+v.y},m={x:l.x+g.x,y:l.y+g.y},_={x:c.x+g.x,y:c.y+g.y},x=T.intersectionPoint([y,p],[m,_]);s.vertices[h].x=x.x,s.vertices[h].y=x.y}var k=new e.Shape,w=new e.Path;k.moveTo(s.vertices[0].x,s.vertices[0].y),w.moveTo(o.vertices[0].x,o.vertices[0].y);for(var C=o.vertices.length-1;C>0;C--)k.lineTo(s.vertices[C].x,s.vertices[C].y),w.lineTo(o.vertices[C].x,o.vertices[C].y);return k.closePath(),w.closePath(),k.holes.push(w),k}},{key:"geometryIsCW",value:function(t){for(var e=t.vertices,i=0;i<e.length;i++){var n=new b(e[i+1].x-e[i].x,e[i+1].y-e[i].y),o=new b(e[i+2].x-e[i+1].x,e[i+2].y-e[i+1].y);n.rotate90CW();if(0!==n.dot(o))return n.dot(o)>0;console.log("dot product is 0")}}},{key:"generateStrokeMesh",value:function(i,n){var o=t.generateStrokeShape(i,n),s=new e.ShapeGeometry(o),r=new t({primitive:"custom",geometry:s});return r.constructMesh(),r}},{key:"generateStrokeMeshFromShape",value:function(i){var n=new e.ShapeGeometry(i),o=new t({primitive:"custom",geometry:n});return o.constructMesh(),o.material.setColor(this.strokeColor),o}},{key:"CreatePlane",value:function(e,i,n,o){return new t({primitive:"plane",width:e,height:i,segments:n,material:"material"})}},{key:"CreateBox",value:function(e,i,n,o,s){return new t({primitive:"box",width:e,height:i,depth:n,segments:o,material:s})}},{key:"CreateText",value:function(e,i,n,o,s,r){return new t({primitive:"text",text:e,font:typeface,fontSize:n,height:r,segments:s,material:o})}},{key:"CreateSphere",value:function(e,i,n,o){return new t({primitive:"sphere",radius:e,widthSegments:hsegments,heightSegments:vsegments,material:o})}},{key:"CreateCircle",value:function(e,i,n){return new t({primitive:"circle",segments:i,material:n})}}]),t}(),H=function(t){function n(t){r(this,n);var o=i(t,{});o.threshold=i(o.threshold,void 0);var s=l(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o));return s.material=void 0,s.material=void 0,s.material=new B({type:"line"}),o.mesh?s.mesh=new e.LineSegments(new e.EdgesGeometry(o.mesh.geometry,o.threshold),s.material._material):s.mesh=new e.LineSegments(new e.EdgesGeometry(s._geometry,o.threshold),s.material._material),s.transform=void 0,s.transform=new X(s),s}return u(n,t),n}(N),V=function(){function t(e){r(this,t),this.context=e}return a(t,null,[{key:"substract",value:function(t,e){var i=new ThreeBSP(t.mesh),n=new ThreeBSP(e.mesh),o=i.subtract(n),s=o.toGeometry();return new N(void 0,void 0,s)}},{key:"union",value:function(t,e){var i=new ThreeBSP(t.mesh),n=new ThreeBSP(e.mesh),o=i.union(n),s=o.toGeometry();return new N(void 0,void 0,s)}},{key:"intersect",value:function(t,e){var i=new ThreeBSP(t.mesh),n=new ThreeBSP(e.mesh),o=i.intersect(n),s=o.toGeometry();return new N(void 0,void 0,s)}}]),t}(),Y=new Map([["Windows 10",/(Windows 10.0|Windows NT 10.0)/],["Windows 8.1",/(Windows 8.1|Windows NT 6.3)/],["Windows 8",/(Windows 8|Windows NT 6.2)/],["Windows 7",/(Windows 7|Windows NT 6.1)/],["Windows Vista",/Windows NT 6.0/],["Windows Server 2003",/Windows NT 5.2/],["Windows XP",/(Windows NT 5.1|Windows XP)/],["Windows 2000",/(Windows NT 5.0|Windows 2000)/],["Windows ME",/(Win 9x 4.90|Windows ME)/],["Windows 98",/(Windows 98|Win98)/],["Windows 95",/(Windows 95|Win95|Windows_95)/],["Windows NT 4.0",/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/],["Windows CE",/Windows CE/],["Windows 3.11",/Win16/],["Android",/Android/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux|X11)/],["iOS",/(iPhone|iPad|iPod)/],["Mac OS X",/Mac OS X/],["Mac OS",/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/],["QNX",/QNX/],["UNIX",/UNIX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/]]),G={},q=function(){function t(){r(this,t)}return a(t,null,[{key:"parseOSData",value:function(){var t="unknown",e="unknown",i=!0,n=!1,o=void 0;try{for(var s,r=Y[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=c(s.value,2),h=a[0];if(a[1].test(navigator.userAgent)){t=h,/Windows/.test(t)&&(e=/Windows (.*)/.exec(t)[1],t="Windows");break}}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}switch(t){case"Mac OS X":e=/Mac OS X (10[\.\_\d]+)/.exec(navigator.userAgent)[1];break;case"Android":e=/Android ([\.\_\d]+)/.exec(navigator.userAgent)[1];break;case"iOS":e=/OS (\d+)_(\d+)_?(\d+)?/.exec(navigator.appVersion),e=e[1]+"."+e[2]+"."+(0|e[3])}G.os=t,G.osVersion=e}},{key:"parseBrowserData",value:function(){var t=navigator.appName,e=void 0,i=void 0,n=void 0,o=void 0;-1!=(n=navigator.userAgent.indexOf("Opera"))?(t="Opera",e=navigator.userAgent.substring(n+6),-1!=(n=navigator.userAgent.indexOf("Version"))&&(e=navigator.userAgent.substring(n+8))):-1!=(n=navigator.userAgent.indexOf("MSIE"))?(t="Microsoft Internet Explorer",e=navigator.userAgent.substring(n+5)):-1!=(n=navigator.userAgent.indexOf("Chrome"))?(t="Chrome",e=navigator.userAgent.substring(n+7)):-1!=(n=navigator.userAgent.indexOf("Safari"))?(t="Safari",e=navigator.userAgent.substring(n+7),-1!=(n=navigator.userAgent.indexOf("Version"))&&(e=navigator.userAgent.substring(n+8))):-1!=(n=navigator.userAgent.indexOf("Firefox"))?(t="Firefox",e=navigator.userAgent.substring(n+8)):-1!=navigator.userAgent.indexOf("Trident/")?(t="Microsoft Internet Explorer",e=navigator.userAgent.substring(navigator.userAgent.indexOf("rv:")+3)):(nameOffset=navigator.userAgent.lastIndexOf(" ")+1)<(n=navigator.userAgent.lastIndexOf("/"))&&(t=navigator.userAgent.substring(nameOffset,n),e=navigator.userAgent.substring(n+1),t.toLowerCase()==t.toUpperCase()&&(t=navigator.appName)),-1!=(o=e.indexOf(";"))&&(e=e.substring(0,o)),-1!=(o=e.indexOf(" "))&&(e=e.substring(0,o)),-1!=(o=e.indexOf(")"))&&(e=e.substring(0,o)),i=parseInt(""+e,10),isNaN(i)&&(e=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10)),G.browser=t,G.browserVersion=e,G.browserMajorVersion=i}},{key:"getType",value:function(){return"type"in G||(G.type=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion)?"mobile":"desktop"),G.type}},{key:"getOS",value:function(){return"os"in G||t.parseOSData(),G.os}},{key:"getOSVersion",value:function(){return"osVersion"in G||t.parseOSData(),G.osVersion}},{key:"getBrowser",value:function(){return"browser"in G||t.parseBrowserData(),G.browser}},{key:"getBrowserVersion",value:function(){return"browserVersion"in G||t.parseBrowserData(),G.browserVersion}},{key:"getBrowserMajorVersion",value:function(){return"browserMajorVersion"in G||t.parseBrowserData(),G.browserMajorVersion}},{key:"getFramework",value:function(){return"framework"in G||(G.framework=null,navigator.userAgent.toLowerCase().indexOf("ejecta")>-1?G.framework="ejecta":window.cordova&&(G.framework="cordova")),G.framework}},{key:"getScreenWidth",value:function(){return window.screen.width}},{key:"getScreenHeight",value:function(){return window.screen.height}},{key:"getScreenSize",value:function(){return{width:t.getScreenWidth(),height:t.getScreenHeight()}}}]),t}(),Q=function(t){function e(){return r(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),a(e,[{key:"setup",value:function(){this._manager=null,this._batteryAvailable=void 0!==navigator.getBattery}},{key:"on",value:function(){var t=this;this._batteryAvailable?(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),navigator.getBattery().then(function(e){return t.onBatteryManager(e)})):L.warn("The battery API is not supported on this device")}},{key:"off",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this._manager&&(this._manager.removeEventListener("chargingchange",function(e){return t.onChargingChange(e)}),this._manager.removeEventListener("chargingtimechange",function(e){return t.onChargingTimeChange(e)}),this._manager.removeEventListener("levelchange",function(e){return t.onLevelChange(e)}),this._manager.removeEventListener("dischargingtimechange",function(e){return t.onDischargingTimeChange(e)}),this._manager=null)}},{key:"onBatteryManager",value:function(t){var e=this;this.getStatus()&&(this._manager=t,this._manager.addEventListener("chargingchange",function(t){return e.onChargingChange(t)}),this._manager.addEventListener("chargingtimechange",function(t){return e.onChargingTimeChange(t)}),this._manager.addEventListener("levelchange",function(t){return e.onLevelChange(t)}),this._manager.addEventListener("dischargingtimechange",function(t){return e.onDischargingTimeChange(t)}))}},{key:"onChargingChange",value:function(t){this.events.trigger("chargingchange",t.target.charging)}},{key:"onChargingTimeChange",value:function(t){this.events.trigger("chargingtimechange",t.target.chargingTime)}},{key:"onDischargingTimeChange",value:function(t){this.events.trigger("dischargingtimechange",t.target.dischargingTime)}},{key:"onLevelChange",value:function(t){this.events.trigger("levelchange",t.target.level)}},{key:"isCharging",value:function(){return this._manager?this._manager.charging:(L.warn("The battery component needs to be active to get battery information"),null)}},{key:"getChargingTime",value:function(){return this._manager?this._manager.chargingTime:(L.warn("The battery component needs to be active to get battery information"),null)}},{key:"getDischargingTime",value:function(){return this._manager?this._manager.dischargingTime:(L.warn("The battery component needs to be active to get battery information"),null)}},{key:"getLevel",value:function(){return this._manager?this._manager.level:(L.warn("The battery component needs to be active to get battery information"),null)}}]),e}(g),K=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._target=i(t,"target",window),n}return u(e,t),a(e,[{key:"on",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),this._target.addEventListener("keydown",function(e){return t.onKeyDown(e)}),this._target.addEventListener("keypress",function(e){return t.onKeyPress(e)}),this._target.addEventListener("keyup",function(e){return t.onKeyUp(e)})}},{key:"off",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this._target.removeEventListener("keydown",function(e){return t.onKeyDown(e)}),this._target.removeEventListener("keypress",function(e){return t.onKeyPress(e)}),this._target.removeEventListener("keyup",function(e){return t.onKeyUp(e)})}},{key:"setup",value:function(){this._isPressed=!1,this._keyDownCode}},{key:"update",value:function(){}},{key:"getKeyIsDown",value:function(t){return this._keyDownCode===t.toLowerCase()}},{key:"onKeyDown",value:function(t){this._keyDownCode=String.fromCharCode(t.keyCode).toLowerCase(),this.events.trigger("keydown",t)}},{key:"onKeyPress",value:function(t){this._keyDownCode=String.fromCharCode(t.keyCode).toLowerCase(),this.events.trigger("keypress",t),this._isPressed=!0,t.preventDefault()}},{key:"onKeyUp",value:function(t){this._keyDownCode=void 0,this._isPressed=!1,this.events.trigger("keyup",t)}}]),e}(g),Z=function(){function t(){r(this,t)}return a(t,null,[{key:"getElementPosition",value:function(t){for(var e=0,i=0;t;){if("BODY"===t.tagName){var n=t.scrollLeft||document.documentElement.scrollLeft,o=t.scrollTop||document.documentElement.scrollTop;e+=t.offsetLeft-n+t.clientLeft,i+=t.offsetTop-o+t.clientTop}else e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop;t=t.offsetParent}return{x:e,y:i}}}]),t}(),J=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._target=i(t,"target",window),n}return u(e,t),a(e,[{key:"setup",value:function(){this._x=null,this._y=null,this._pX=null,this._pY=null,this._dragStartX=null,this._dragStartY=null,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._pressed=!1,
this._wheelActivated=!1,this._resetWheel=!1}},{key:"on",value:function(){var t=this;if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),!this._target)return void L.error("Can't activate the mouse input component without a target");this._target.addEventListener("mousemove",function(e){return t.onMouseMove(e)}),this._target.addEventListener("mouseover",function(e){return t.onMouseOver(e)}),this._target.addEventListener("mouseout",function(e){return t.onMouseOut(e)}),this._target.addEventListener("mousedown",function(e){return t.onMouseDown(e)}),this._target.addEventListener("mouseup",function(e){return t.onMouseUp(e)}),this._target.addEventListener("click",function(e){return t.onClick(e)}),this._target.addEventListener("dblclick",function(e){return t.onDblClick(e)}),this._target.addEventListener("wheel",function(e){return t.onWheel(e)})}},{key:"off",value:function(){var t=this;if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),!this._target)return void L.error("Can't deactivate the mouse input component without a target");this._target.removeEventListener("mousemove",function(e){return t.onMouseMove(e)}),this._target.removeEventListener("mouseover",function(e){return t.onMouseOver(e)}),this._target.removeEventListener("mouseout",function(e){return t.onMouseOut(e)}),this._target.removeEventListener("mousedown",function(e){return t.onMouseDown(e)}),this._target.removeEventListener("mouseup",function(e){return t.onMouseUp(e)}),this._target.removeEventListener("click",function(e){return t.onClick(e)}),this._target.removeEventListener("dblclick",function(e){return t.onDblClick(e)}),this._target.removeEventListener("wheel",function(e){return t.onWheel(e)})}},{key:"preUpdate",value:function(){this._wheelActivated&&(this._resetWheel?(this._wheelActivated=!1,this._resetWheel=!1,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0):this._resetWheel=!0)}},{key:"update",value:function(){}},{key:"postUpdate",value:function(){this._pX=this._x,this._pY=this._y}},{key:"onMouseMove",value:function(t){if(!this._target instanceof Window){var e=Z.getElementPosition(this._target);this._x=t.clientX-e.x,this._y=t.clientY-e.y}else this._x=t.clientX,this._y=t.clientY;this.events.trigger("mousemove",{x:this.getX(),y:this.getY()}),this.isPressed()&&this.events.trigger("mousedrag",{pX:this.getPX(),pY:this.getPY(),x:this.getX(),y:this.getY()}),t.preventDefault()}},{key:"onMouseOver",value:function(t){this.events.trigger("mouseover"),t.preventDefault()}},{key:"onMouseOut",value:function(t){this.events.trigger("mouseout"),t.preventDefault()}},{key:"onMouseDown",value:function(t){this._pressed=!0,this._dragStartX=this.getX(),this._dragStartY=this.getY(),this.events.trigger("mousepress",t.button),t.preventDefault()}},{key:"onMouseUp",value:function(t){this._pressed=!1,this._dragStartX=null,this._dragStartY=null,this.events.trigger("mouserelease"),t.preventDefault()}},{key:"onClick",value:function(t){this.events.trigger("mouseclick",t.button),t.preventDefault()}},{key:"onDblClick",value:function(t){this.events.trigger("mousedblclick",t.button),t.preventDefault()}},{key:"onWheel",value:function(t){this._wheelActivated=!0,this._wheelDeltaX+=t.deltaX,this._wheelDeltaY+=t.deltaY,this._wheelDeltaZ+=t.deltaZ,this.events.trigger("mousewheel",t.deltaX,t.deltaY,t.deltaZ),t.preventDefault()}},{key:"isPressed",value:function(){return this._pressed}},{key:"getX",value:function(){return this._x}},{key:"getY",value:function(){return this._y}},{key:"getPX",value:function(){return this._pX}},{key:"getPY",value:function(){return this._pY}},{key:"getDeltaX",value:function(){return this._x-this._pX}},{key:"getDeltaY",value:function(){return this._y-this._pY}},{key:"getDelta",value:function(){return{x:this.getDeltaX(),y:this.getDeltaY()}}},{key:"getDragOffsetX",value:function(){return this.isPressed()?this.getX()-this._dragStartX:0}},{key:"getDragOffsetY",value:function(){return this.isPressed()?this.getY()-this._dragStartY:0}},{key:"getDragOffset",value:function(){return{x:this.getDragOffsetX(),y:this.getDragOffsetY()}}},{key:"isWheelSupported",value:function(){return"desktop"===q.getType()&&void 0!==window.WheelEvent}},{key:"isWheelActivated",value:function(){return this._wheelActivated}},{key:"getWheelDeltaX",value:function(){return this._wheelDeltaX}},{key:"getWheelDeltaY",value:function(){return this._wheelDeltaY}},{key:"getWheelDeltaZ",value:function(){return this._wheelDeltaZ}},{key:"getWheelDelta",value:function(){return{x:this.getWheelDeltaX(),y:this.getWheelDeltaY(),z:this.getWheelDeltaZ()}}}]),e}(g),$=function(){function t(e,i,n){r(this,t),this.index=n,this.x=e,this.y=i,this.pX=this.x,this.pY=this.y,this.id=void 0,this.xDelta=0,this.yDelta=0,this.startX=this.x,this.startY=this.y,this.offsetX=0,this.offsetY=0}return a(t,[{key:"setX",value:function(t){this.x=t,this.xDelta=this.x-this.pX,this.offsetX=this.x-this.startX}},{key:"setY",value:function(t){this.y=t,this.yDelta=this.y-this.pY,this.offsetY=this.y-this.startY}},{key:"setPX",value:function(){this.pX=this.x}},{key:"setPY",value:function(){this.pY=this.y}}]),t}(),tt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._target=i(t,"target",window),n._time=new O,n}return u(e,t),a(e,[{key:"setup",value:function(){this.getContext().addComponent(this._time),this._time.setup(),this._time.on(),this.count=0,this.pressed=!1,this.touches={},this.taps=0,this.tapsMaxInterval=500,this.oldTapTime=0,this.pinchTouches=[],this.pinchStart=0,this.pinch=0,this.pinchActive=!1,this.touchState,this.touchDown,this.touchUp}},{key:"on",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),this._target.addEventListener("touchstart",function(e){return t.onTouchStart(e)}),this._target.addEventListener("touchend",function(e){return t.onTouchEnd(e)}),this._target.addEventListener("touchcancel",function(e){return t.onTouchEnd(e)}),this._target.addEventListener("touchleave",function(e){return t.onTouchEnd(e)}),this._target.addEventListener("touchmove",function(e){return t.onTouchMove(e)})}},{key:"off",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this._target.removeEventListener("touchstart",function(e){return t.onTouchStart(e)}),this._target.removeEventListener("touchend",function(e){return t.onTouchEnd(e)}),this._target.removeEventListener("touchcancel",function(e){return t.onTouchEnd(e)}),this._target.removeEventListener("touchleave",function(e){return t.onTouchEnd(e)}),this._target.removeEventListener("touchmove",function(e){return t.onTouchMove(e)})}},{key:"update",value:function(){this.pressed&&!this.touchState?this.touchDown=!0:this.touchDown=!1,!this.pressed&&this.touchState?this.touchUp=!0:this.touchUp=!1,this.touchState=this.pressed;for(var t in this.touches)this.touches[t].setPX(),this.touches[t].setPY()}},{key:"onTouchStart",value:function(t){var e=(this.getContext(),Z.getElementPosition(this._target)),i=null;if(null!==t.changedTouches&&void 0!==t.changedTouches)for(var n=0;n<t.changedTouches.length;n++){var o=t.changedTouches[n];if(o.identifier in this.touches){var s=this.touches[s.identifier],r=s.pageX-e.x,a=s.pageY-e.x;s.setX(r),s.setY(a)}else{var h=o.pageX-e.x,u=o.pageY-e.x;i=new $(h,u,this.count),L.log("newTouch",i),i.setX(h),i.setY(u),i.id=o.identifier,i.up=!1,i.down=!0,this.touches[o.identifier]=i,this.count+=1}this.events.trigger("touchstart",i)}this._time.getTime()-this.oldTapTime<this.tapsMaxInterval?(this.taps+=1,this.events.trigger("tapchanged",this.taps)):(this.taps=1,this.events.trigger("tapchanged",this.taps)),this.oldTapTime=this._time.getTime(),this.pressed=!0,this.events.trigger("pressedchanged",this.pressed),t.preventDefault()}},{key:"onTouchEnd",value:function(t){if(null!==t.changedTouches&&void 0!==t.changedTouches){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];i.identifier in this.touches&&(this.events.trigger("touchend",this.touches[i.identifier]),delete this.touches[i.identifier],this.count-=1)}this.count<=1&&(this.pinchTouches=[],this.pinchStart=0,this.pinch=0,this.pinchActive=!1)}0===this.count&&(this.pressed=!1,this.events.trigger("pressedchanged",this.pressed)),t.preventDefault()}},{key:"onTouchMove",value:function(t){var e=Z.getElementPosition(this._target);if(null!==t.changedTouches&&void 0!==t.changedTouches)for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i];if(n.identifier in this.touches){var o=this.touches[n.identifier],s=n.pageX-e.x,r=n.pageY-e.y;o.setX(s),o.setY(r),this.events.trigger("touchmoved",o)}}this.taps=0,t.preventDefault()}},{key:"getX",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches)this.touches[i].index===t&&(e=this.touches[i].x);return e}},{key:"getY",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches)this.touches[i].index===t&&(e=this.touches[i].y);return e}},{key:"get",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches)this.touches[i].index===t&&(e=this.touches[i]);return e}},{key:"getDeltaX",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches){var n=this.touches[i];n.index===t&&(e=n.xDelta)}return e}},{key:"getDeltaY",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches){var n=this.touches[i];n.index===t&&(e=n.yDelta)}return e}},{key:"getDelta",value:function(t){var e=void 0;if("number"==typeof t)for(var i in this.touches){var n=this.touches[i];n.index===t&&(e={x:n.xDelta,y:n.yDelta})}return e}},{key:"getOffsetX",value:function(t){var e=void 0;for(var i in this.touches){var n=this.touches[i];n.index===t&&(e=n.offsetX)}return e}},{key:"getOffsetY",value:function(t){var e=void 0;for(var i in this.touches){var n=this.touches[i];n.index===t&&(e=n.offsetY)}return e}},{key:"getOffset",value:function(t){var e=void 0;for(var i in this.touches){var n=this.touches[i];n.index===t&&(e={x:n.offsetX,y:n.offsetY})}return e}},{key:"getPinch",value:function(){var t=0;if(this.count>=2){if(void 0===this.pinchTouches[1])for(var e in this.touches)if(t<2&&(this.pinchTouches[t]=this.touches[e],t++),2===t){this.pinchActive=!0,this.pinchStart=T.dist(this.pinchTouches[0].x,this.pinchTouches[0].y,this.pinchTouches[1].x,this.pinchTouches[1].y);break}this.pinch=T.dist(this.pinchTouches[0].x,this.pinchTouches[0].y,this.pinchTouches[1].x,this.pinchTouches[1].y)-this.pinchStart,this.pinchStart=T.dist(this.pinchTouches[0].x,this.pinchTouches[0].y,this.pinchTouches[1].x,this.pinchTouches[1].y)}else this.pinchStart=0,this.pinch=0,this.pinchTouches=[];return this.pinch}}]),e}(g),et=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._accAvailable=window.DeviceMotionEvent,i}return u(e,t),a(e,[{key:"setup",value:function(){this.rotationRate=new C,this.acc=new C,this.userAcc=new C,this.smoothedAcc=new C,this.accel=[0,0,0],this.kFilteringFactor=.07,this.gravityVector=new C}},{key:"on",value:function(){var t=this;this._accAvailable?(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),window.addEventListener("devicemotion",function(e){return t.onDeviceMotion(e)})):L.info("this device doesn't have acceloremeters")}},{key:"off",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),window.removeEventListener("devicemotion",function(e){return t.onDeviceMotion(e)})}},{key:"onDeviceMotion",value:function(t){var e=this,i=1;"Android"===q.getOS()&&(i=-1),t.acceleration&&(this.userAcc.x=t.acceleration.x*i,this.userAcc.y=t.acceleration.y*i,this.userAcc.z=t.acceleration.z*i,null!==t.acceleration.x&&void 0!==t.acceleration.x||this.computeUserAcc(),this.events.trigger("acceleration",this.userAcc)),t.accelerationIncludingGravity&&(this.acc.x=t.accelerationIncludingGravity.x*i,this.acc.y=t.accelerationIncludingGravity.y*i,this.acc.z=t.accelerationIncludingGravity.z*i,this.events.trigger("accelerationIncludingGravity",this.acc),this.events.trigger("accelerationGravityVector",function(){return e.computeGravityVector(),e.gravityVector})),t.rotationRate&&(this.rotationRate.x=t.rotationRate.alpha,this.rotationRate.y=t.rotationRate.beta,this.rotationRate.z=t.rotationRate.gamma,this.events.trigger("rotationrate",this.rotationRate))}},{key:"computeUserAcc",value:function(){this.accel[0]=this.acc.x*this.kFilteringFactor+this.accel[0]*(1-this.kFilteringFactor),this.accel[1]=this.acc.y*this.kFilteringFactor+this.accel[1]*(1-this.kFilteringFactor),this.accel[2]=this.acc.z*this.kFilteringFactor+this.accel[2]*(1-this.kFilteringFactor),this.userAcc.x=this.acc.x-this.accel[0],this.userAcc.y=this.acc.y-this.accel[1],this.userAcc.z=this.acc.z-this.accel[2]}},{key:"computeGravityVector",value:function(){this.accel[0]=this.acc.x*this.kFilteringFactor+this.accel[0]*(1-this.kFilteringFactor),this.accel[1]=this.acc.y*this.kFilteringFactor+this.accel[1]*(1-this.kFilteringFactor),this.accel[2]=this.acc.z*this.kFilteringFactor+this.accel[2]*(1-this.kFilteringFactor),this.gravityVector.z=this.accel[2]*(360/(2*Math.PI))*1.1,this.gravityVector.x=this.accel[1]*(360/(2*Math.PI))*1.1,this.gravityVector.y=Math.atan2(this.accel[0],this.accel[1])*(180/Math.PI)}},{key:"getUserAcc",value:function(){return this.userAcc}},{key:"getAcc",value:function(){return this.acc}},{key:"getGravityVector",value:function(){return this.gravityVector}},{key:"getSmoothedAcc",value:function(t){return this.smoothedAcc.x=this.acc.x*t+this.smoothedAcc.x*(1-t),this.smoothedAcc.y=this.acc.y*t+this.smoothedAcc.y*(1-t),this.smoothedAcc.z=this.acc.z*t+this.smoothedAcc.z*(1-t),this.smoothedAcc}}]),e}(g),it=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.compassAvailable=window.DeviceOrientationEvent,i}return u(e,t),a(e,[{key:"setup",value:function(){this.compass=new C,this.deviceRotationMatrix=new x,this.deviceHeading=null,this.deviceAttitude=null,this.deviceBank=null}},{key:"on",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),window.addEventListener("deviceorientation",function(e){return t.onDeviceOrientation(e)}),window.addEventListener("compassneedscalibration",function(e){return t.onCompassCalibration(e)})}},{key:"off",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),window.removeEventListener("deviceorientation",function(e){return t.onDeviceOrientation(e)}),window.removeEventListener("compassneedscalibration",function(e){return t.onCompassCalibration(e)})}},{key:"getDeviceOrientation",value:function(){return this.compass}},{key:"createGyroQuaternion",value:function(t,e,i,n){if(0!==t&&0!==e&&0!==i){var o=new k,s=new m,r=new k,a=new k(-Math.sqrt(.5),0,0,Math.sqrt(.5)),h=0;return s.set(e,t,-i,"YXZ"),o.setFromEuler(s),h=-n/2,r.set(0,Math.sin(h),0,Math.cos(h)),o.multiply(r),o.multiply(a),o}return new k(0,0,0)}},{key:"getGyroQuaternion",value:function(){if(this.compassAvailable&&this.compass.alpha){return this.createGyroQuaternion(T.degToRad(this.compass.alpha),T.degToRad(this.compass.beta),T.degToRad(this.compass.gamma),T.degToRad(window.orientation||0))}}},{key:"onCompassCalibration",value:function(t){this.events.trigger("compassneedscalibration",t)}},{key:"onDeviceOrientation",value:function(t){this.compass.alpha=t.alpha,this.compass.beta=t.beta,this.compass.gamma=t.gamma,t.webkitCompassHeading?this.compass.heading=t.webkitCompassHeading:this.compass.heading=-t.alpha,this.events.trigger("deviceorientation",this.compass)}},{key:"computeRotationMatrix",value:function(t,e,i){var n=e?T.degToRad(e):0,o=i?T.degToRad(i):0,s=t?T.degToRad(t):0,r=Math.cos(n),a=Math.cos(o),h=Math.cos(s),u=Math.sin(n),l=Math.sin(o),c=Math.sin(s),d=h*a-c*u*l,f=-r*c,v=a*c*u+h*l,g=a*c+h*u*l,y=h*r,p=c*l-h*a*u,m=-r*l,_=u,x=r*a;return this.deviceRotationMatrix.set(d,g,m,0,f,y,_,0,v,p,x,0,0,0,0,1),f>.998?(this.deviceHeading=Math.atan2(m,x),this.deviceAttitude=Math.PI/2,void(this.deviceBank=0)):f<-.998?(this.deviceHeading=Math.atan2(m,x),this.deviceAttitude=-Math.PI/2,void(this.deviceBank=0)):(this.deviceHeading=Math.atan2(-v,d),this.deviceBank=Math.atan2(-_,y),void(this.deviceAttitude=Math.asin(f)))}},{key:"updateDeviceRotationMatrix",value:function(){this.computeRotationMatrix(this.compass.alpha,this.compass.beta,this.compass.gamma)}},{key:"getDeviceRotationMatrix",value:function(){return this.updateDeviceRotationMatrix(),this.deviceRotationMatrix}}]),e}(g),nt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._enableHighAccuracy=i(t,"enableHighAccuracy",!1),n._maximumAge=i(t,"maximumAge",void 0),n._timeout=i(t,"timeout",void 0),n._GPSAvailable=void 0!==navigator&&"geolocation"in navigator,n}return u(e,t),a(e,[{key:"setup",value:function(){this._location={latitude:null,longitude:null,altitude:null,accuracy:null,altitudeAccuracy:null,heading:null,speed:null,timestamp:null},this._watchID}},{key:"on",value:function(){var t=this;if(this._GPSAvailable){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this);var i={enableHighAccuracy:this._enableHighAccuracy,timeout:this._timeout,maximumAge:this._maximumAge};this._watchID=navigator.geolocation.watchPosition(function(e){return t.updateLocationCallBack(e)},function(e){return t.updateLocationErrorCallBack(e)},i)}else L.info("this device has no GPS!")}},{key:"off",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),navigator.geolocation.clearWatch(this._watchID)}},{key:"setEnableHighAccuracy",value:function(t){this._enableHighAccuracy=t}},{key:"setTimeout",value:function(t){this._timeout=t}},{key:"setMaximumAge",value:function(t){this._maximumAge=t}},{key:"getLocation",value:function(){if(this._active)return this._location;L.warn("geolocation is off, turn it on with context.input.setGeolocationStatus(true);")}},{key:"updateLocationCallBack",value:function(t){this._location.longitude=t.coords.longitude,this._location.latitude=t.coords.latitude,this._location.altitude=t.coords.altitude,this._location.accuracy=t.coords.accuracy,this._location.altitudeAccuracy=t.coords.altitudeAccuracy,this._location.heading=t.coords.heading,this._location.speed=t.coords.speed,this._location.timestamp=t.timestamp,this._location.error="no error",this.events.trigger("locationupdated",this._location)}},{key:"updateLocationErrorCallBack",value:function(t){1===t.code?(console.error("location permission denied"),this._location.error="location permission denied"):2===t.code?(console.error("location unavailable"),this._location.error="location unavailable"):3===t.code&&(console.error("location timeout"),this._location.error="location timeout"),this.events.trigger("locationerror",this._location.error)}},{key:"resetLocation",value:function(){this._location={latitude:null,longitude:null,altitude:null,accuracy:null,altitudeAccuracy:null,heading:null,speed:null,timestamp:null}}}]),e}(g),ot={};ot.zoom=1,ot.worldSize=512*Math.pow(2,ot.zoom);var st=function(){function t(){r(this,t)}return a(t,null,[{key:"getPixelsCoordsFromOSMLngLat",value:function(e,i,n){return n&&(ot.zoom=n,ot.worldSize=512*Math.pow(2,ot.zoom)),{x:t.lngX(e),y:t.latY(i)}}},{key:"getCoordinateInMap",value:function(e,i,n,o,s,r){r&&(ot.zoom=r);var a=n[0],h=n[1],u=n[2],l=n[3],c=t.getPixelsCoordsFromOSMLngLat(u,l),d=t.getPixelsCoordsFromOSMLngLat(a,l),f=t.getPixelsCoordsFromOSMLngLat(u,h),v=(t.getPixelsCoordsFromOSMLngLat(a,h),t.getPixelsCoordsFromOSMLngLat(e,i));return{x:T.map(v.x,c.x,d.x,o/2,-s/2),y:T.map(v.y,c.y,f.y,o/2,-s/2)}}},{key:"lngX",value:function(t){return(180+t)*ot.worldSize/360}},{key:"latY",value:function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*ot.worldSize/360}},{key:"xLng",value:function(t){return 360*t/ot.worldSize-180}},{key:"yLat",value:function(t){var e=180-360*t/ot.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"getPolarFromLngLat",value:function(t,e,i){var n=T.degToRad(t+180),o=T.degToRad(90-e);return{x:-i*Math.cos(n)*Math.sin(o),y:i*Math.cos(o),z:i*Math.sin(o)*Math.sin(n)}}}]),t}(),rt=function(){function t(){r(this,t)}return a(t,null,[{key:"Noise",value:function(t,e){for(var i=t.getVertices(),n=0;n<i.length;++n){var o=new C(Math.random()-.5,Math.random()-.5,Math.random()-.5);i[n]=new C(i[n].x+o.x*e,i[n].y+o.y*e,i[n].z+o.z*e)}t.setVertices(i)}},{key:"Nothing",value:function(t,e){for(var i=t.getVertices(),n=0;n<i.length;++n){new C(Math.random()-.5,Math.random()-.5,Math.random()-.5);i[n]=new C(i[n].x,i[n].y,i[n].z)}t.setVertices(i)}},{key:"Offset",value:function(t,e){for(var i=t.getVertices(),n=0;n<i.length;++n)i[n]=new C(i[n].x+e.x,i[n].y+e.y,i[n].z+e.z);t.setVertices(i)}},{key:"Scale",value:function(t,e){for(var i=t.getVertices(),n=0;n<i.length;++n)i[n]=new C(i[n].x*e.x,i[n].y*e.y,i[n].z*e.z);t.setVertices(i)}}]),t}(),at=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.midioutname=t.out,i.midiinname=t.in,i.onMidiIn=t.onMidiIn,L.log("params.onMidiIn="+t.onMidiIn),L.log("this.onMidiIn="+i.onMidiIn),navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(i.onMIDIInit.bind(i),i.onMIDIReject.bind(i)):console.warn("No MIDI support present in your browser. Try in another browser."),i}return u(e,t),a(e,[{key:"onMIDIInit",value:function(t){this.midiAccess=t,this.hookUpMIDI(),this.midiAccess.onstatechange=this.hookUpMIDI}},{key:"onMIDIReject",value:function(t){alert("The MIDI system failed to start.  You're gonna have a bad time.")}},{key:"hookUpMIDI",value:function(){if(void 0!==this.midiinname){var t=this.midiAccess.inputs.values();L.log("MIDI inputs on your system : ");for(var e=t.next();e&&!e.done;e=t.next()){L.log("input=",e);var i=e.value.name;i===this.midiinname&&(L.log("found midi interface IN : "+i),e.value.onmidimessage=this.onMIDIMessage.bind(this))}}if(void 0!==this.midioutname){var n=this.midiAccess.outputs.values();L.log("MIDI outputs on your system : ");for(var o=n.next();o&&!o.done;o=n.next()){L.log("output=",o);var i=o.value.name;i===this.midioutname&&(L.log("found midi interface OUT : "+i),this.midioutput=o.value)}}}},{key:"onMIDIMessage",value:function(t){if(L.log("this.onMidiIn="+this.onMidiIn),void 0!==this.onMidiIn){var e=240&t.data[0],i=t.data[0]-e,n=t.data[1],o=t.data[2];this.onMidiIn(i,e,n,o)}}},{key:"ControlChange",value:function(t,e,i){if(void 0!==this.midioutput){var n;n=[176+t,e,i],this.midioutput.send(n)}}},{key:"NoteOn",value:function(t,e,i){if(void 0!==this.midioutput){var n;n=[144+t,e,i],this.midioutput.send(n)}}},{key:"NoteOff",value:function(t,e,i){if(void 0!==this.midioutput){var n;n=[128+t,e,i],this.midioutput.send(n)}}}]),e}(g);at.NoteOn=144,at.NoteOff=128,at.Aftertouch=160,at.ControlChange=176,at.ProgramChange=192;var ht=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.timers=[],i.current_frame=0,i.last_time=0,i.initialize(),i}return u(e,t),a(e,[{key:"initialize",value:function(){var t=this.getTime();this.last_time;this.last_time=t}},{key:"update",value:function(){var t=this.getTime(),e=t-this.last_time;this.last_time=t;var i=this.timers[this.current_frame];i||(i={},this.timers[this.current_frame]=i),this.timers[this.current_frame].dt=e,this.current_frame++,this.logTimers()}},{key:"startTimer",value:function(t){}},{key:"getTime",value:function(){return(new Date).getTime()}},{key:"logTimers",value:function(){var t="";for(var e in this.timers)t+=this.timers[e].dt+" ";console.log("Profiler timers : "+t)}}]),e}(g),ut="readystatechange",lt="start",ct="progress",dt="load",ft="success",vt="error",gt=function(){function t(e){r(this,t),this.url=e.url,this.method=i(e,"method","GET");var n=i(e,"data",null),o=i(e,"headers",null);this.async=i(e,"async",!0);var s=i(e,"autoSend",!0),a=i(e,"withCredentials",null),h=i(e,"timeout",null),u=i(e,"responseType","text"),l=i(e,"onReadyStateChange",null),c=i(e,"onStart",null),d=i(e,"onProgress",null),f=i(e,"onLoad",null),g=i(e,"onSuccess",null),y=i(e,"onError",null);if(this.events=new v({scope:this}),this._xhr=new XMLHttpRequest,l&&this.events.on(ut,l),c&&this.events.on(lt,c),d&&this.events.on(ct,d),f&&this.events.on(dt,f),g&&this.events.on(ft,g),y&&this.events.on(vt,y),this._xhr.addEventListener("readystatechange",this.onReadyStateChange.bind(this)),"GET"===this.method&&n){var p=[];for(var m in n)p.push(m+"="+encodeURIComponent(n[m]));this.url+="?"+p.join("&"),n=null}if(this.setResponseType(u),null!==o)for(var _ in o)this.setRequestHeader(_,o[_]);null!==a&&this.setWithCredentials(a),null!==h&&this.setTimeout(h),s&&(this._xhr.open(this.method,this.url,this.async),this.send(n))}return a(t,[{key:"onReadyStateChange",value:function(){switch(this.events.trigger(ut,this),this.getReadyState()){case XMLHttpRequest.OPENED:this.events.trigger(lt,this);break;case XMLHttpRequest.LOADING:this.events.trigger(ct,this);break;case XMLHttpRequest.DONE:var t=this.getStatus(),e=!1;200===t&&t<300||304===t?e=!0:0!==t||this._xhr.error||(e=!0),this.events.trigger(dt,this,e),e?this.events.trigger(ft,this):this.events.trigger(vt,this)}}},{key:"getXHR",value:function(){return this._xhr}},{key:"setRequestHeader",value:function(t,e){this._xhr.setRequestHeader(t,e)}},{key:"setWithCredentials",value:function(t){this._xhr.withCredentials=t}},{key:"setTimeout",value:function(t){this._xhr.timeout=t}},{key:"setResponseType",value:function(t){this._xhr.responseType=t}},{key:"send",value:function(t){this._xhr.open(this.method,this.url,this.async),this._xhr.send(t)}},{key:"abort",value:function(){this._xhr.abort()}},{key:"getStatus",value:function(){return this._xhr.status}},{key:"getStatusText",value:function(){return this._xhr.statusText}},{key:"getReadyState",value:function(){return this._xhr.readyState}},{key:"getResponseType",value:function(){return this._xhr.responseType}},{key:"getResponse",value:function(){return this._xhr.response}},{key:"getResponseText",value:function(){return this._xhr.responseText}},{key:"getJSON",value:function(){return JSON.parse(this.getResponseText())}}],[{key:"get",value:function(e){return e.method="GET",new t(e)}},{key:"post",value:function(e){return e.method="POST",new t(e)}},{key:"put",value:function(e){return e.method="PUT",new t(e)}}]),t}(),yt=function(){function t(){r(this,t)}return a(t,null,[{key:"load",value:function(e,i){return t.callBack=i.onLoad,e.loadText({url:i.url,onLoad:t.parseOBJ.bind(null,e)})}},{key:"attachTexture",value:function(t,e,i){console.log("attachTexture ",t,e,i),e.material.setTexture(i)}},{key:"parseMTL",value:function(e,i,n){console.log("model="+i),console.log("mtl content =",n),n.toString().split("\n").forEach(function(n){var o=n.split(" ");switch(o[0]){case"#":break;case"newmtl":console.log("new material : "+o[1]);break;case"Ka":i.material.setEmissiveColor(new Mobilizing.Color(o[1],o[2],o[3]));break;case"Kd":i.material.setColor(new Mobilizing.Color(o[1],o[2],o[3]));break;case"Ks":i.material.setSpecularColor(new Mobilizing.Color(o[1],o[2],o[3])),i.material._material.shininess=20;break;case"Ns":case"d":case"Tr":case"illum":break;case"map_Kd":e.loadTexture({url:o[1],onLoad:t.attachTexture.bind(null,e,i)}),i.updateMaterial();break;default:console.log("unknown MTL line : ",o)}})}},{key:"parseOBJ",value:function(e,i){console.log("onLoaded data=",i),console.log("loader=",e),t.text=i,console.log("text=",t.text);var n;void 0!==t.mesh?n=t.mesh:(console.log("create material"),n=new N({}),n.material=new B({type:"phong"}),console.log("Material created : ",n.material)),console.log("parsing obj file...");var o=t.text.toString().split("\n"),s=[],r=[];o.forEach(function(i){var o=i.split(" ");switch(o[0]){case"mtllib":console.log("mtllib "+o[1]),t.resultmtl=e.loadText({url:o[1],onLoad:t.parseMTL.bind(null,e,n)});break;case"usemtl":console.log("usemtl "+o[1]);break;case"o":console.log("OBJ o "+o[1]);break;case"g":console.log("OBJ g "+o[1]);break;case"v":var a=new C(o[1],o[2],o[3]);n.pushVertex(a);break;case"vt":L.log("uv "+o[1]+" "+o[2]);var h=new b(o[1],o[2]);s.push(h);break;case"vn":var u=new C(o[1],o[2],o[3]);r.push(u);break;case"s":break;case"f":var l=o[1].split("/"),c=o[2].split("/"),d=o[3].split("/");if(n.pushFace(l[0]-1,c[0]-1,d[0]-1),n.pushUV(s[l[1]-1],s[c[1]-1],s[d[1]-1]),n.pushNormal(r[l[2]-1],r[c[2]-1],r[d[2]-1]),o.length>4){var f=o[4].split("/");n.pushFace(l[0]-1,d[0]-1,f[0]-1),n.pushUV(s[l[1]-1],s[d[1]-1],s[f[1]-1])}}}),n.computeNormals(),console.log("callback called : ",n),t.callBack(n)}}]),t}(),pt="start",mt="load",_t="error",xt="load",kt="error",wt="complete",bt="pending",Ct=function(){function t(e){r(this,t),this._consumeCallback=e.consume,this._value=void 0,this._error=void 0,this.events=new v({scope:this});var n=i(e,"onStart",null),o=i(e,"onLoad",null),s=i(e,"onError",null);n&&this.events.on(pt,n),o&&this.events.on(mt,o),s&&this.events.on(_t,s)}return a(t,[{key:"consume",value:function(){this._consumeCallback(this)}},{key:"setValue",value:function(t){this._value=t}},{key:"getValue",value:function(){return this._value}},{key:"setError",value:function(t){this._error=t}},{key:"getError",value:function(){return this._error}}]),t}(),Tt=function(){function t(e){r(this,t);var n=i(e,"onLoad",null),o=i(e,"onError",null),s=i(e,"onComplete",null);this._status=bt,this._requests=[],this._complete=0,this.events=new v({scope:this}),n&&this.events.on(xt,n),o&&this.events.on(kt,o),s&&this.events.on(wt,s)}return a(t,[{key:"consumeAll",value:function(){if(this._requests.length>0){this._status="loading";var t=!0,e=!1,i=void 0;try{for(var n,o=this._requests[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){n.value.consume()}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}}else this.doComplete()}},{key:"doComplete",value:function(){this._status="complete",this.events.trigger(wt,this._requests)}},{key:"load",value:function(t){var e=this,n=t.url,o=i(t,"onStart",null),s=i(t,"onLoad",null),r=i(t,"onError",null),a=i(t,"responseType",""),h=i(t,"processData",function(t){return t.getResponse()}),u=new gt({url:n,responseType:a,autoSend:!1}),l=new Ct({consume:function(t){u.send()},onStart:o,onLoad:s,onError:r});return u.events.on("start",function(t){l.events.trigger(pt)}),u.events.on("success",function(t){var i=h(t,e);l.setValue(i),l.events.trigger(mt,i),e.events.trigger(xt,l),++e._complete==e._requests.length&&e.doComplete()}),u.events.on("error",function(t){var i=t.getStatusText();l.setError(i),l.events.trigger(_t,i),e.events.trigger(kt,l),++e._complete==e._requests.length&&e.doComplete()}),this._requests.push(l),"loading"===this._status&&l.consume(),l}},{key:"loadText",value:function(t){return this.load(Object.assign({},t,{responseType:"text"}))}},{key:"loadJSON",value:function(t){return this.load(Object.assign({},t,{responseType:"json"}))}},{key:"loadImage",value:function(t){var e=this,n=t.url,o=i(t,"onStart",null),s=i(t,"onLoad",null),r=i(t,"onError",null),a=new Image,h=new Ct({consume:function(t){a.src=n,t.events.trigger(pt)},onStart:o,onLoad:s,onError:r});return a.addEventListener("load",function(){h.setValue(a),h.events.trigger(mt,a),e.events.trigger(xt,h),++e._complete==e._requests.length&&e.doComplete()},!1),a.addEventListener("error",function(){var t="Error loading the image "+n;h.setError(t),h.events.trigger(_t,t),e.events.trigger(kt,h),++e._complete==e._requests.length&&e.doComplete()}),this._requests.push(h),"loading"===this._status&&h.consume(),h}},{key:"loadVideo",value:function(t){var e=this,n=t.url,o=i(t,"onStart",null),s=i(t,"onLoad",null),r=i(t,"onError",null),a=document.createElement("video");a.autoplay=!1;var h=new Ct({consume:function(t){a.src=n,a.load(),t.events.trigger(pt)},onStart:o,onLoad:s,onError:r});return a.addEventListener("canplay",function(){h.setValue(a),h.events.trigger(mt,a),e.events.trigger(xt,h),
++e._complete==e._requests.length&&e.doComplete()},!1),a.addEventListener("error",function(){var t="Error loading the video "+n+" "+a.error.code;L.log(a.error),h.setError(t),h.events.trigger(_t,t),e.events.trigger(kt,h),++e._complete==e._requests.length&&e.doComplete()}),this._requests.push(h),"loading"===this._status&&h.consume(),h}},{key:"loadArrayBuffer",value:function(t){return this.load(Object.assign({},t,{responseType:"arraybuffer"}))}},{key:"loadBlob",value:function(t){return this.load(Object.assign({},t,{responseType:"blob"}))}},{key:"loadOBJ",value:function(t){return yt.load(this,t)}},{key:"loadTexture",value:function(t){var e=new U;console.log("try to load "+t.url);var i=this.loadImage({url:t.url,onLoad:function(i){e.fromImage(i),void 0!==t.onLoad&&(console.log("call onLoad:",t.onLoad),t.onLoad(e))}});return console.log("result=",i),e}}],[{key:"load",value:function(e,i,n,o){if(t.Cache.isLoading(e)&&i)return void t.Cache.addCallback(e,i);if(t.Cache.isCached(e))return L.info("ressource "+e+" is cached and won't be loaded again"),t.Cache.get(e);t.Cache.addKey(e);var s=new gt({url:e,responseType:n,autoSend:!1});void 0===o&&(o=function(t){return t.getResponse()}),s.events.on("success",function(n){var s=o(n);i(s),t.Cache.addValue(e,s)}),s.events.on("error",function(t){i(void 0,t.getStatusText())}),s.send()}},{key:"loadText",value:function(e,i){t.load(e,i,"text")}},{key:"loadJSON",value:function(e,i){t.load(e,i,"json")}},{key:"loadArrayBuffer",value:function(e,i){t.load(e,i,"arraybuffer")}},{key:"loadBlob",value:function(e,i){t.load(e,i,"blob")}},{key:"loadImage",value:function(t,e){var i=new Image;i.addEventListener("load",function(){e(i)},!1),i.addEventListener("error",function(){e(void 0,"Error loading the image "+t)},!1),i.src=t}},{key:"loadScript",value:function(t,e){var i=document.createElement("script");document.head.appendChild(i),i.addEventListener("load",function(){e()}),i.src=t}}]),t}(),St=function(){function t(){r(this,t),this.enabled=!0,this.files={},this.callbacks=[]}return a(t,[{key:"enable",value:function(t){this.enabled=!1}},{key:"add",value:function(t,e){!1!==this.enabled&&(this.getKey(t)||(L.info("Cache Adding key and file:",t,e),this.files[t]=e))}},{key:"addKey",value:function(t){!1!==this.enabled&&(this.getKey(t)||(L.info("Cache Adding key:",t),this.files[t]=void 0))}},{key:"addValue",value:function(t,e){if(!1!==this.enabled&&this.getKey(t)&&void 0===this.files[t]&&this.getKey(t)&&void 0===this.files[t]){L.info("Cache Adding value:",e,"to key",t),this.files[t]=e;for(var i=this.callbacks.length-1;i>=0;i--)if(this.callbacks[i].key===t){var n=this.callbacks[i].callback;n(e),this.callbacks.splice(i,1)}L.log("this.callbacks.length",this.callbacks.length)}}},{key:"get",value:function(t){if(!1!==this.enabled)return this.files[t]}},{key:"remove",value:function(t){delete this.files[t]}},{key:"isCached",value:function(t){return!!this.files[t]}},{key:"isLoading",value:function(t){return!!this.getKey(t)}},{key:"getKey",value:function(t){for(var e=Object.keys(this.files),i=0;i<e.length;i++)if(e[i]===t)return e[i]}},{key:"clear",value:function(){this.files={}}},{key:"addCallback",value:function(t,e){var i={key:t,callback:e};this.callbacks.push(i)}}]),t}();Tt.Cache=new St;var Mt=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.targetScript=t.targetScript,i.targetScript.context=t.context,i.targetScript.getContext=function(){return this.context},i}return u(e,t),a(e,[{key:"preLoad",value:function(){if("function"==typeof this.targetScript.preLoad){var t;(t=this.targetScript).preLoad.apply(t,arguments)}}},{key:"setup",value:function(){this.targetScript.setup()}},{key:"update",value:function(){this.targetScript.update()}}]),e}(g),Lt=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._components=[],i.loader=new Tt,i}return u(e,t),a(e,[{key:"init",value:function(){}},{key:"setup",value:function(){for(var t in this._components)this.chainedCall(this._components[t],"setup")}},{key:"preLoad",value:function(){for(var t in this._components)this._components[t].preLoad(this.loader)}},{key:"update",value:function(){for(var t in this._components)this.chainedCall(this._components[t],"preUpdate");for(var t in this._components)this.chainedCall(this._components[t],"update");for(var t in this._components)this.chainedCall(this._components[t],"postUpdate")}},{key:"chainedCall",value:function(t,e){t[e]();var i=t.getChainedComponents();if(i.length>0)for(var n in i)this.chainedCall(i[n],e)}},{key:"addComponent",value:function(t){return t instanceof g||(t=new Mt({targetScript:t,context:this})),this._components.push(t),t.setContext(this),t}}]),e}(g),Ot=function(){function t(e){r(this,t),this.callback=i(e,"callback",void 0),this.context=e.context,"complete"===document.readyState?this.run():window.addEventListener("load",this.run.bind(this)),this.frame=0}return a(t,[{key:"run",value:function(){this.context.init(),this.context.preLoad(),this.context.loader.events.on("complete",function(){this.startLoop()}.bind(this)),this.context.loader.consumeAll()}},{key:"startLoop",value:function(){this.context.setup(),this.loop()}},{key:"onFrameBegin",value:function(){this.frame++,void 0!==this.context.stats&&this.context.stats.begin()}},{key:"onFrameEnd",value:function(){void 0!==this.context.stats&&this.context.stats.end()}},{key:"loop",value:function(){this.onFrameBegin(),this.context.update(),this.onFrameEnd(),requestAnimationFrame(this.loop.bind(this))}}]),t}(),Rt=function(){function t(e){r(this,t);var n=i(e,"x",0),o=i(e,"y",0),s=i(e,"state",!1),a=i(e,"type",void 0);this._x=n,this._y=o,this._deltaX=0,this._deltaY=0,this._state=s,this._type=a,this._component=null}return a(t,[{key:"setComponent",value:function(t){this._component=t}},{key:"getComponent",value:function(t){return this._component}},{key:"setX",value:function(t){this._x=t}},{key:"setY",value:function(t){this._y=t}},{key:"getX",value:function(){return this._x}},{key:"getY",value:function(){return this._y}},{key:"setDeltaX",value:function(t){this._deltaX=t}},{key:"setDeltaY",value:function(t){this._deltaY=t}},{key:"getDeltaX",value:function(){return this._deltaX}},{key:"getDeltaY",value:function(){return this._deltaY}},{key:"setState",value:function(t){this._state=t}},{key:"getState",value:function(){return this._state}},{key:"setType",value:function(t){this._type=t}},{key:"getType",value:function(){return this._type}}]),t}(),Pt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),o=i(t,"components",void 0);if(n.pointers=new Map,n.lastActivePointer=new Rt,n.lastActivePointer.setType("lastActive"),o)for(var s in o){var a=o[s];n.add(a)}return n}return u(e,t),a(e,[{key:"postUpdate",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=this.pointers.keys()[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var s=n.value,r=this.pointers.get(s);!1===r.getState()&&"touch"===r.getType()&&this.pointers.delete(s),"touch"===r.getType()?(r.setDeltaX(r.getComponent().getDeltaX()),r.setDeltaY(r.getComponent().getDeltaY())):"mouse"===r.getType()&&(r.setDeltaX(r.getComponent().getDeltaX()),r.setDeltaY(r.getComponent().getDeltaY()))}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}}},{key:"add",value:function(t){var e=this;if(t instanceof tt){var i=t;i.events.on("touchstart",function(i){var n=new Rt;n.setComponent(t),n.setType("touch"),n.setState(!0),n.setX(i.x),n.setY(i.y),e.pointers.set(i.id,n),e.events.trigger("on",{pointer:n,x:n.getX(),y:n.getY()}),e.lastActivePointer.setState(!0),e.lastActivePointer.setX(i.x),e.lastActivePointer.setY(i.y)}),i.events.on("touchmoved",function(t){var i=e.pointers.get(t.id);i.setState(!0),i.setX(t.x),i.setY(t.y),i.setDeltaX(t.xDelta),i.setDeltaY(t.yDelta),e.events.trigger("moved",{pointer:i,x:i.getX(),y:i.getY()}),e.lastActivePointer.setState(!0),e.lastActivePointer.setX(t.x),e.lastActivePointer.setY(t.y),e.lastActivePointer.setDeltaX(t.xDelta),e.lastActivePointer.setDeltaY(t.yDelta)}),i.events.on("touchend",function(t){var i=e.pointers.get(t.id);i.setState(!1),i.setX(t.x),i.setY(t.y),e.events.trigger("off",{pointer:i}),e.lastActivePointer.setState(!1),e.lastActivePointer.setX(t.x),e.lastActivePointer.setY(t.y)})}else if(t instanceof J){var n=t,o=new Rt;o.setComponent(t),o.setType("mouse"),n.events.on("mousepress",function(i){var n=e.pointers.get(t.getID());n.setState(!0),e.events.trigger("on",{pointer:n,x:n.getX(),y:n.getY()}),e.lastActivePointer.setState(!0)}),n.events.on("mouserelease",function(i){var n=e.pointers.get(t.getID());n.setState(!1),e.events.trigger("off",{pointer:n}),e.lastActivePointer.setState(!1)}),n.events.on("mousemove",function(i){var o=e.pointers.get(t.getID());o.setDeltaX(n.getDeltaX()),o.setDeltaY(n.getDeltaY()),o.setX(i.x),o.setY(i.y),e.events.trigger("moved",{pointer:o,x:o.getX(),y:o.getY()}),e.lastActivePointer.setState(!0),e.lastActivePointer.setX(o.getX()),e.lastActivePointer.setY(o.getY()),e.lastActivePointer.setDeltaX(o.getDeltaX()),e.lastActivePointer.setDeltaY(o.getDeltaY())}),this.pointers.set(t.getID(),o)}}},{key:"get",value:function(t){return this.pointers.get(t.id)}},{key:"getPointers",value:function(){return Array.from(this.pointers.values())}},{key:"getState",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=this.pointers.values()[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){if(n.value.getState())return!0}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}return this.events.trigger("off"),!1}},{key:"getX",value:function(t){var e=[],i=!0,n=!1,o=void 0;try{for(var s,r=this.pointers.values()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;e.push(a.getX())}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t?void 0===t?e:e[t]:this.lastActivePointer.getX()}},{key:"getY",value:function(t){var e=[],i=!0,n=!1,o=void 0;try{for(var s,r=this.pointers.values()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;e.push(a.getY())}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t?void 0===t?e:e[t]:this.lastActivePointer.getY()}},{key:"getDeltaX",value:function(t){var e=[],i=!0,n=!1,o=void 0;try{for(var s,r=this.pointers.values()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;e.push(a.getDeltaX())}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t?void 0===t?e:e[t]:this.lastActivePointer.getDeltaX()}},{key:"getDeltaY",value:function(t){var e=[],i=!0,n=!1,o=void 0;try{for(var s,r=this.pointers.values()[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;e.push(a.getDeltaY())}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t?void 0===t?e:e[t]:this.lastActivePointer.getDeltaY()}}]),e}(g),Et=function(){function t(e){r(this,t);var n=i(e,"url",""),o=i(e,"autoConnect",!0);this.events=new v({scope:this}),o&&this.open(n)}return a(t,[{key:"open",value:function(t){var e=this;if("undefined"==typeof io){var i=document.createElement("script");i.src=t+"/socket.io/socket.io.js",i.onload=function(){e.open(t)},document.head.appendChild(i)}else this.socket=io(t),this.socket.on("connect",function(){e.socket.on("disconnect",function(){e.events.trigger("disconnect")}),e.events.trigger("connect")}),this.socket.on("error",function(t){e.events.trigger("error",t)})}},{key:"close",value:function(){this.socket&&(this.socket.disconnect(),delete this.socket)}},{key:"publish",value:function(t,e){this.socket&&this.socket.emit("publish",{channel:t,message:e})}},{key:"subscribe",value:function(t,e){this.socket&&(this.socket.emit("subscribe",{channel:t}),this.socket.on(t,e))}},{key:"unsubscribe",value:function(t){this.socket&&(this.socket.emit("unsubscribe",{channel:t}),this.socket.off(t))}},{key:"getID",value:function(){return this.socket?this.socket.id:null}}]),t}(),zt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.joints=[],n.bodies=[],n.iterations=i(t,"iterations",5),n.G=6.6742*Math.pow(10,-11),n.ke=8.99*Math.pow(10,9),n.relaxationCoeff=1,n}return u(e,t),a(e,[{key:"setup",value:function(){this.context=this.getContext(),this._time=new O,this.context.addComponent(this._time),this._time.setup(),this._time.on()}},{key:"update",value:function(){if(this._active){var t=0,e=void 0,i=void 0,n=void 0,o=void 0,s=void 0,r=void 0,a=void 0,h=void 0,u=this._time.getDelta();if(0==u)return;u>1&&(u=1);for(var l=void 0,c=0;c<this.bodies.length;++c)e=this.bodies[c],e.forces=new C(0,0,0);for(var d=0;d<this.joints.length;++d)if(i=this.joints[d],i.enabled)if("spring"===i.type){n=i.body1.position,o=i.body2.position,s=o.x-n.x,r=o.y-n.y,a=o.z-n.z,h=Math.sqrt(s*s+r*r+a*a),l=(h-i.distance)*i.k,i.body1.forces.x+=s*l,i.body1.forces.y+=r*l,i.body1.forces.z+=a*l,i.body2.forces.x-=s*l,i.body2.forces.y-=r*l,i.body2.forces.z-=a*l;var f=i.body2.velocity.x-i.body1.velocity.x,v=i.body2.velocity.y-i.body1.velocity.y,g=i.body2.velocity.z-i.body1.velocity.z;i.body1.forces.x+=f*i.damping,i.body1.forces.y+=v*i.damping,i.body1.forces.z+=g*i.damping,i.body2.forces.x-=f*i.damping,i.body2.forces.y-=v*i.damping,i.body2.forces.z-=g*i.damping}else if("gravity"===i.type){n=i.body1.position,o=i.body2.position,s=o.x-n.x,r=o.y-n.y,a=o.z-n.z,h=Math.sqrt(s*s+r*r+a*a),s/=h,r/=h,a/=h;var y=i.body1.mass+i.body2.mass;l=this.G*y/(h*h),i.body1.forces.x+=s*l,i.body1.forces.y+=r*l,i.body1.forces.z+=a*l,i.body2.forces.x-=s*l,i.body2.forces.y-=r*l,i.body2.forces.z-=a*l}else"electrostatics"===i.type&&(n=i.body1.position,o=i.body2.position,s=o.x-n.x,r=o.y-n.y,a=o.z-n.z,h=Math.sqrt(s*s+r*r+a*a),s/=h,r/=h,a/=h,l=this.ke*i.charge1*i.charge2/(h*h),i.body1.forces.x-=s*l,i.body1.forces.y-=r*l,i.body1.forces.z-=a*l,i.body2.forces.x+=s*l,i.body2.forces.y+=r*l,i.body2.forces.z+=a*l);for(t=0;t<this.bodies.length;++t){e=this.bodies[t];e.position;void 0!==e.speed?(e.velocity=new C(e.speed.x,e.speed.y,e.speed.z),e.speed=void 0):(e.velocity=new C(e.position.x-e.previousposition.x,e.position.y-e.previousposition.y,e.position.z-e.previousposition.z),e.velocity.x/=u,e.velocity.y/=u,e.velocity.z/=u),e.previousposition=new C(e.position.x,e.position.y,e.position.z),void 0!==this.globalgravity&&(e.forces.x+=this.globalgravity.x*e.mass,e.forces.y+=this.globalgravity.y*e.mass,e.forces.z+=this.globalgravity.z*e.mass),void 0!==this.globalwind&&(e.forces.x+=this.globalwind.x,e.forces.y+=this.globalwind.y,e.forces.z+=this.globalwind.z);var p=new C(0,0,0);p.x=e.forces.x/e.mass,p.y=e.forces.y/e.mass,p.z=e.forces.z/e.mass,e.velocity.x+=p.x*u,e.velocity.y+=p.y*u,e.velocity.z+=p.z*u,e.position.x+=e.velocity.x*u,e.position.y+=e.velocity.y*u,e.position.z+=e.velocity.z*u}for(var m=0;m<this.iterations;++m)for(var _=0;_<this.joints.length;++_)if(i=this.joints[_],i.enabled)if("stick"===i.type||"string"===i.type){n=i.body1.position,o=i.body2.position,s=o.x-n.x,r=o.y-n.y,a=o.z-n.z,h=Math.sqrt(s*s+r*r+a*a);var x=(h-i.distance)/h*1;if("stick"===i.type||"string"===i.type&&h>i.distance){var k=x/2,w=x/2;i.body1.fixed?(k=0,w=x):i.body2.fixed&&(k=x,w=0),n.x=n.x+s*k*this.relaxationCoeff,o.x=o.x-s*w*this.relaxationCoeff,n.y=n.y+r*k*this.relaxationCoeff,o.y=o.y-r*w*this.relaxationCoeff,n.z=n.z+a*k*this.relaxationCoeff,o.z=o.z-a*w*this.relaxationCoeff}}else"fixed"===i.type&&(i.body1.position=new C(i.position.x,i.position.y,i.position.z),i.body1.velocity=new C(0,0,0));for(t=0;t<this.bodies.length;++t)e=this.bodies[t],void 0!==e.object&&e.object.transform.setLocalPosition(e.position)}}},{key:"addBody",value:function(t,e,i){var n={};return n.position=new C(t.x,t.y,t.z),n.previousposition=new C(t.x,t.y,t.z),n.mass=e,n.object=i,n.velocity=new C(0,0,0),this.bodies.push(n),n}},{key:"addFixedJoint",value:function(t,e){var i={};return i.body1=t,i.body1.fixed=!0,i.type="fixed",i.position=new C(e.x,e.y,e.z),i.enabled=!0,this.joints.push(i),i}},{key:"addStickJoint",value:function(t,e,i){var n={};return n.body1=t,n.body2=e,n.type="stick",n.distance=i,n.enabled=!0,this.joints.push(n),n}},{key:"addSpringJoint",value:function(t,e,i,n,o){var s={};return s.body1=t,s.body2=e,s.type="spring",s.distance=i,s.k=n,s.damping=o,s.enabled=!0,this.joints.push(s),s}},{key:"addStringJoint",value:function(t,e,i){var n={};return n.body1=t,n.body2=e,n.type="string",n.distance=i,n.enabled=!0,this.joints.push(n),n}},{key:"addGravityJoint",value:function(t,e){var i={};return i.body1=t,i.body2=e,i.type="gravity",i.enabled=!0,this.joints.push(i),i}},{key:"addElectrostaticsJoint",value:function(t,e,i,n){var o={};return o.body1=t,o.body2=e,o.type="electrostatics",o.charge1=i,o.charge2=n,o.enabled=!0,this.joints.push(o),o}},{key:"setGlobalGravity",value:function(t){this.globalgravity=t}},{key:"setGlobalWind",value:function(t){this.globalwind=t}}]),e}(g),Ft=function(){function t(e){r(this,t),e.canvas?(L.log("try to attach the Canvas...",canvas),this.renderer=new THREE.WebGLRenderer({canvas:canvas}),this.engine="webgl",void 0===this.renderer.devicePixelRatio&&(this.renderer.devicePixelRatio=window.devicePixelRatio),this.renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),this.renderer.setSize(canvas.width/window.devicePixelRatio,canvas.height/window.devicePixelRatio),canvas.style.width=canvas.width/window.devicePixelRatio+"px",canvas.style.height=canvas.height/window.devicePixelRatio+"px",this.canvas=canvas,this.canvas.retinaResolutionEnabled=!0,this.windowWidth=this.canvas.clientWidth,this.windowHeight=this.canvas.clientHeight,L.log("existing CANVAS",this.renderer)):(L.log("retrieve Canvas failed, create a new canvas"),this.renderer=new THREE.WebGLRenderer,this.engine="webgl",this.renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),void 0===this.renderer.devicePixelRatio&&(this.renderer.devicePixelRatio=window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement,this.canvas.retinaResolutionEnabled=!0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight),L.log("engine = "+this.engine),this.renderer.setClearColor(0,1),this.renderer.autoClear=!0,L.log("window pixel ratio = "+window.devicePixelRatio)}return a(t,[{key:"getCanvas",value:function(){return this.canvas}}]),t}();t.Renderer3D=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.canvas=i(t,"canvas",void 0),n.scenes=[],n.cameras=[],n.fog=void 0,n.setCurrentScene("default"),n.engine=new Mobilizing.Engine3D({canvas:n.canvas}),n.canvas?(n.fullscreen=!1,L.log("got canvas from runner to context",n.canvas)):(n.canvas=n.engine.canvas,n.fullscreen=!0,L.log("got canvas from Engine",n.canvas)),window.addEventListener("orientationchange",function(t){return n.onWindowResize(t)},!1),window.addEventListener("resize",function(t){return n.onWindowResize(t)},!1),window.addEventListener("scroll",function(t){return n.updateCanvasPosition(t)},!1),window.addEventListener("resize",function(t){return n.updateCanvasPosition(t)},!1),n.canvasPosition=n.getCanvasPosition(),n}return u(e,t),a(e,[{key:"update",value:function(){this.render()}},{key:"setClearColor",value:function(t,e){this.engine.renderer.setClearColor(t,e)}},{key:"setEnableShadowMap",value:function(t){this.engine.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.engine.renderer.shadowMapEnabled=t}},{key:"setCurrentScene",value:function(t){this.scene=this.scenes[t],void 0===this.scene&&(this.scene=new THREE.Scene,this.scenes[t]=this.scene,L.log("current scene is : ",this.scene))}},{key:"addToCurrentScene",value:function(t){this.scene.add(t.transform.entity)}},{key:"removeFromCurrentScene",value:function(t){this.scene.remove(t.transform.entity)}},{key:"clear",value:function(){console.log("scene=",this.scene);for(var t in this.scene){var e=this.scene[t];console.log("key ",t),console.log("removing ",e),this.scene.remove(e)}this.scene.children=[],this.cameras=[]}},{key:"addCamera",value:function(t){this.cameras.push(t)}},{key:"removeCamera",value:function(t){this.cameras.splice(this.cameras.indexOf(t),1)}},{key:"setFog",value:function(t,e){switch(e||(e=p.black.clone()),t){case"linear":this.fog=new THREE.Fog(e.getHex()),this.fog.type="linear";break;case"exp":this.fog=new THREE.FogExp2(e.getHex()),this.fog.type="exp";break;default:this.fog=new THREE.Fog(e.getHex()),this.fog.type="linear"}this.scene.fog=this.fog}},{key:"setFogNear",value:function(t){"linear"===this.fog.type&&(this.fog.near=t)}},{key:"setFogFar",value:function(t){"linear"===this.fog.type&&(this.fog.far=t)}},{key:"setFogDensity",value:function(t){"exp"===this.fog.type&&(this.fog.density=t)}},{key:"setFogColor",value:function(t){this.fog.color=t}},{key:"onWindowResize",value:function(){var t=this;this.fullscreen&&(this.cameras.forEach(function(e){if("perspective"===e.type){var i=t.engine.renderer.domElement.width/t.engine.renderer.devicePixelRatio,n=t.engine.renderer.domElement.height/t.engine.renderer.devicePixelRatio;e.setAspect(i*e.viewport.width/(n*e.viewport.height))}else"ortho"===e.type&&e.setOrthoPlanes(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2)}),this.engine.renderer.setSize(window.innerWidth,window.innerHeight))}},{key:"render",value:function(){for(var t=0;t<this.cameras.length;++t)this.cameras[t].sort=!1,void 0===this.cameras[t].index&&(this.cameras[t].index=0);for(var e=[],i=9999,n=null,o=0;o<this.cameras.length;++o){i=9999,n=null;for(var s=0;s<this.cameras.length;++s){var r=this.cameras[s];r.index<=i&&!r.sort&&(n=r,i=r.index)}n&&(n.sort=!0,e.push(n))}for(var a=0;a<e.length;++a){var h=e[a];if(h.transform.getVisible()&&(h.dirty||h.autorender)){var u=this.engine.renderer.domElement.width/this.engine.renderer.devicePixelRatio,l=this.engine.renderer.domElement.height/this.engine.renderer.devicePixelRatio;"cube"!==h.type&&h.setAspect(u*h.viewport.width/(l*h.viewport.height));var c=u*h.viewport.x,d=l*h.viewport.y,f=u*h.viewport.width,v=l*h.viewport.height;this.engine.renderer.setViewport(c,d,f,v),this.engine.renderer.setScissor(c,d,f,v),this.engine.renderer.setScissorTest(!0),this.engine.renderer.autoClear=h.autoclear;for(var g in this.scenes)1===this.logLevel&&L.log("render cam/scene ",h,g),h.layer===g&&(void 0!==h.renderTexture?this.engine.renderer.render(this.scenes[g],h._camera,h.renderTexture._engineTexture,h.autoClear):"cube"===h.type?h._camera.updateCubeMap(this.engine.renderer,this.scenes[g]):this.engine.renderer.render(this.scenes[g],h._camera),h.dirty=!1)}}}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasSize",value:function(){return{width:this.canvas.width/window.devicePixelRatio,height:this.canvas.height/window.devicePixelRatio}}},{key:"getCanvasPosition",value:function(){return Z.getElementPosition(this.canvas)}},{key:"updateCanvasPosition",value:function(){this.canvasPosition=this.getCanvasPosition()}}]),e}(g),t.Renderer3D=s(t.Renderer3D),t.RendererAudio=function(t){function e(t){r(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(i.renderer=i.getContext(),i.audioContext=void 0,(void 0===i.params||i.params.audioEnabled)&&(void 0!==window.AudioContext?i.audioContext=new window.AudioContext:void 0!==window.webkitAudioContext&&(i.audioContext=new window.webkitAudioContext),i.audioContext)){if(44100!==i.audioContext.sampleRate){var n=i.audioContext.createBuffer(1,1,44100),o=i.audioContext.createBufferSource();o.buffer=n,o.connect(i.audioContext.destination),o.start(0),o.disconnect(),i.audioContext.close(),void 0!==window.AudioContext?i.audioContext=new window.AudioContext:void 0!==window.webkitAudioContext&&(i.audioContext=new window.webkitAudioContext)}i.audioOutputNode=i.audioContext.createGain(),i.audioOutputNode.connect(i.audioContext.destination)}return i.listener=i.audioContext.listener,i.listener.forwardX?(i.listener.forwardX.value=0,i.listener.forwardY.value=0,i.listener.forwardZ.value=-1,i.listener.upX.value=0,i.listener.upY.value=1,i.listener.upZ.value=0):i.listener.setOrientation(0,0,-1,0,1,0),i}return u(e,t),a(e,[{key:"beep",value:function(t){var e=t||440,i=this.audioContext.createOscillator();i.connect(this.audioOutputNode),i.frequency.value=e,i.start(0),i.stop(this.audioContext.currentTime+.3)}},{key:"setListenerTransform",value:function(t){this.listener.transform=t}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.listener.transform){var t=this.listener.transform.getLocalPosition();this.listener.setPosition(t.x,t.y,t.z)}}}]),e}(g),t.RendererAudio=s(t.RendererAudio);var Dt=function(){function t(e){r(this,t),this._fontFile=i(e,"fontFile",void 0),this._font=opentype.parse(this._fontFile)}return a(t,[{key:"getFont",value:function(){return this._font}},{key:"getTextSize",value:function(t,e){var i=void 0,n=void 0,o=void 0,s=void 0,r=void 0,a=void 0,h=void 0,u=[];if(this._font.supported){var l=0;for(e=void 0!==e?e:72,a=a||{},i=void 0===a.kerning||a.kerning,n=1/this._font.unitsPerEm*e,o=this._font.stringToGlyphs(t),s=0;s<o.length;s+=1)r=o[s],u.push((r.getMetrics().yMax-r.getMetrics().yMin)*n),r.advanceWidth&&(l+=r.advanceWidth*n),i&&s<o.length-1&&(h=this._font.getKerningValue(r,o[s+1]),l+=h*n);return{width:l,height:Math.max.apply(0,u)}}}}]),t}(),At=function(){function t(){r(this,t),this.transform=new X(this),this.bias=1,this.factor=-.1}return a(t,[{key:"process",value:function(t){var e=this.transform.getWorldPosition(),i=this.getDistance(t,e);this.bias,this.factor}},{key:"getDistance",value:function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))}},{key:"applyLOD",value:function(t){}}]),t}(),Bt=function(){function t(e){r(this,t),this.letter=i(e,"letter",""),this.size=i(e,"size",40),this.font=i(e,"font",void 0),this.path,this.boundingBox,this.color=i(e,"color",p.black.clone()),this.x=0,this.y=0,this.width=0,this.height=0,this.font&&this.update()}return a(t,[{key:"update",value:function(){var t=this.font.getTextSize(this.letter,this.size);this.width=t.width,this.height=t.height,this.path=this.font.getFont().getPath(this.letter,this.x,this.y,this.size),this.path.fill="#"+this.color.getHexString(),this.boundingBox=this.path.getBoundingBox()}},{key:"setLetter",value:function(t){this.letter=t}},{key:"setX",value:function(t){this.x=t}},{key:"setY",value:function(t){this.y=t}},{key:"setSize",value:function(t){this.size=t}},{key:"setColor",value:function(t){this.color=t}},{key:"setFont",value:function(t){this.font=t}}]),t}(),It=function(){function t(e){r(this,t),this.text=i(e,"text",""),this.font=i(e,"font",void 0),this.size=i(e,"size",40),this.color=i(e,"color",p.black.clone()),this.path,this.boundingBox,this.line=0,this.x=0,this.y=0,this.width=0,this.height=0,this.styledLetters=[],this.font&&this.update()}return a(t,[{key:"update",value:function(){var t=this.font.getTextSize(this.text,this.size);this.width=t.width,this.height=t.height,this.path=this.font.getFont().getPath(this.text,this.x,this.y,this.size),this.path.fill="#"+this.color.getHexString(),this.boundingBox=this.path.getBoundingBox();for(var e=0,i=0;i<this.styledLetters.length;i++){var n=this.styledLetters[i];n.font=this.font,0===i?(n.setX(this.x),e=n.width):(n.setX(this.x+e),e+=n.width),n.setY(this.y),n.setSize(this.size),n.setColor(this.color),n.update()}}},{key:"setFont",value:function(t){this.font=t}},{key:"setColor",value:function(t){this.color=t}},{key:"setX",value:function(t){this.x=t}},{key:"setY",value:function(t){this.y=t}},{key:"setSize",value:function(t){this.size=t}},{key:"setPath",value:function(t){this.path=t}},{key:"setText",value:function(t){this.text=t,this.styledLetters=[];for(var e=0;e<this.text.length;e++){var i=this.text.charCodeAt(e),n=new Bt({letter:String.fromCharCode(i),font:this.font,size:this.size,color:this.color});this.styledLetters.push(n)}}}]),t}(),Wt=function t(){r(this,t),this.styledTextElements=[],this.width=0},Ut="left",jt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n._width=i(t,"width",512),n._height=i(t,"height",512),n._backgroundColor=i(t,"backgroundColor",p.white.clone()),n._lineHeight=i(t,"lineHeight",1),n._margins={left:0,right:0,top:0,bottom:0};var o=i(t,"margins",10);return n._margins.left=i(t,"marginLeft",o),n._margins.right=i(t,"marginRight",o),n._margins.top=i(t,"marginTop",o),n._margins.bottom=i(t,"marginBottom",o),n._textSize=i(t,"textSize",20),n._textColor=i(t,"textColor",p.black.clone()),n._textAlign=i(t,"textAlign",Ut),n._boundingBoxStrokeWidth=i(t,"boundingBoxStrokeWidth",1),n._drawBoundingBox=i(t,"drawBoundingBox",!1),n._fontURL=i(t,"fontURL","fonts/Raleway-Regular.ttf"),n._fontItalicURL=i(t,"fontItalicURL","fonts/Raleway-Regular-Italic.ttf"),n._fontBoldURL=i(t,"fontBoldURL","fonts/Raleway-Bold.ttf"),n._fontBoldItalicURL=i(t,"fontBoldItalicURL","fonts/Raleway-Bold-Italic.ttf"),n._canvas=document.createElement("canvas"),n._canvas.width=n._width,n._canvas.height=n._height,n._canvasContext=n._canvas.getContext("2d"),n._canvas.events=new v({scope:n._canvas}),n._text=i(t,"text",void 0),n._text?(n._DOMText=document.createElement("div"),n._DOMText.innerHTML=n._text,n.styledText=n.parseDOMTree(n._DOMText)):console.error("no html text provided"),n._lines=[],Tt.loadArrayBuffer(n._fontURL,function(t){n._defaultFontFile=t,Tt.loadArrayBuffer(n._fontItalicURL,function(t){n._defaultItalicFontFile=t,Tt.loadArrayBuffer(n._fontBoldURL,function(t){n._defaultBoldFontFile=t,Tt.loadArrayBuffer(n._fontBoldItalicURL,function(t){n._defaultBoldItalicFontFile=t,n.setup()})})})}),n}return u(e,t),a(e,[{key:"setup",value:function(){this._defaultFont=new Dt({fontFile:this._defaultFontFile}),this._defaultItalicFont=new Dt({fontFile:this._defaultItalicFontFile}),this._defaultBoldFont=new Dt({fontFile:this._defaultBoldFontFile}),this._defaultBoldItalicFont=new Dt({fontFile:this._defaultBoldItalicFontFile}),this.render()}},{key:"getWidth",value:function(){return this._width}},{key:"getHeight",value:function(){return this._height}},{key:"getCanvas",value:function(){return this._canvas}},{key:"parseDOMTree",value:function(t){var e=[];return this.processDOMTree(t,e),e}},{key:"processDOMTree",value:function(t,e){var i=0,n=void 0;for("P"===t.tagName&&("P"===t.previousElementSibling.tagName?t.innerHTML=t.innerHTML+"<br>":t.innerHTML="<br><br>"+t.innerHTML+"<br>");n=t.childNodes[i];){if(n.childNodes.length>=1)this.processDOMTree(n,e);else for(var o=n.textContent.split(/\s/),s=0;s<o.length;s++){var r=new It;if(r.attributes=[],r.tags=[],r.setText(o[s]),0!==s&&(r.text=" "+r.text),n.parentNode.attributes)for(var a=0;a<n.parentNode.attributes.length;a++)r.attributes.push({name:n.parentNode.attributes[a].name,value:n.parentNode.attributes[a].value});n.tagName&&r.tags.push(n.tagName);for(var h=n;h.parentNode;)"DIV"!==h.parentNode.tagName&&r.tags.push(h.parentNode.tagName),h=h.parentNode;e.push(r)}i++}return e}},{key:"render",value:function(){this._backgroundColor!==p.transparent.makeRGBAStringWithAlpha(0)&&(this._canvasContext.fillStyle="#"+this._backgroundColor.getHexString(),this._canvasContext.fillRect(0,0,this._width,this._height));for(var t=this._margins.left,e=this._margins.top,i=0,n=0;n<this.styledText.length;n++){var o=this.styledText[n],s=this._defaultFont;(o.tags.indexOf("B")>=0||o.tags.indexOf("STRONG")>=0)&&(s=this._defaultBoldFont),(o.tags.indexOf("I")>=0||o.tags.indexOf("EM")>=0)&&(s=this._defaultItalicFont),(o.tags.indexOf("B")>=0&&o.tags.indexOf("I")>=0||o.tags.indexOf("STRONG")>=0&&o.tags.indexOf("EM")>=0)&&(s=this._defaultBoldItalicFont);var r=this._textSize;o.tags.indexOf("BR")>=0&&(e+=r*this._lineHeight,t=this._margins.left,i++,console.log("lineYOffset",e));var a=this._textColor;e===this._margins.top&&(e+=r);if(t+s.getTextSize(o.text,r).width>this._width-this._margins.right&&(e+=r*this._lineHeight,t=this._margins.left,o.text=o.text.replace(/^\s/,""),i++),
o.attributes)for(var h=0;h<o.attributes.length;h++)"color"===o.attributes[h].name&&(a=new p(o.attributes[h].value)),"size"===o.attributes[h].name&&(r=Number(o.attributes[h].value));o.setFont(s);var u=s.getTextSize(o.text,r);if(o.line=i,o.setX(t),o.setY(e),o.setSize(r),o.setColor(a),o.update(),this._lines[i]){var l=this._lines[i];l.styledTextElements.push(o),l.width+=o.width}else{var c=new Wt;c.styledTextElements.push(o),c.width+=o.width,this._lines.push(c)}t+=u.width}for(var d=0;d<this._lines.length;d++){var f=void 0,v=this._lines[d];switch(this._textAlign){case"center":f=this._width/2-(this._margins.left+v.width/2);break;case"right":f=this._width-this._margins.left-(this._margins.right+v.width)}if(void 0!==f)for(var g=0;g<v.styledTextElements.length;g++){var y=v.styledTextElements[g];y.setX(y.x+f),y.update()}}for(var m=0;m<this.styledText.length;m++){var _=this.styledText[m];if(_.path.draw(this._canvasContext),this._drawBoundingBox){var x=_.path.getBoundingBox();this._canvasContext.beginPath(),this._canvasContext.moveTo(x.x1,x.y1),this._canvasContext.lineTo(x.x2,x.y1),this._canvasContext.lineTo(x.x2,x.y2),this._canvasContext.lineTo(x.x1,x.y2),this._canvasContext.lineTo(x.x1,x.y1-this._boundingBoxStrokeWidth/2),this._canvasContext.lineWidth=this._boundingBoxStrokeWidth,this._canvasContext.stroke()}}this._canvas.events.trigger("drawn")}}]),e}(f),Xt=function(){function t(o){var s=this;r(this,t),this._strokeWidth=i(o,"strokeWidth",1),this._strokeColor=i(o,"strokeColor",void 0),this._strokeOpacity=i(o,"strokeOpacity",1),this._fillColor=i(o,"fillColor",void 0),this._fillOpacity=i(o,"fillOpacity",1),this._width=i(o,"width",100),this._height=i(o,"height",100),this._canvas=n(o,"canvas",function(){var t=document.createElement("canvas");return t.width=s._width,t.height=s._height,t}),this._texture=new e.Texture(this._canvas),this._texture.needsUpdate=!0,this._texture.minFilter=e.NearestFilter,this._texture.magFilter=e.NearestFilter,this._texture.generateMipmaps=!1,this._canvasContext=this._canvas.getContext("2d"),this.update()}return a(t,[{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasContext",value:function(){return this._canvasContext}},{key:"fillWithColor",value:function(t){this.setFillColor(t),this.update(),this._canvasContext.fillRect(0,0,this._width,this._height),this._texture.needsUpdate=!0}},{key:"resizeCanvas",value:function(t,e){this._canvas.width=t,this._canvas.height=e,this._canvasContext=this._canvas.getContext("2d")}},{key:"getWidth",value:function(){return this._width}},{key:"getHeight",value:function(){return this._height}},{key:"setStrokeColor",value:function(t){this._strokeColor=t}},{key:"setFillColor",value:function(t){this._fillColor=t}},{key:"setStrokeWidth",value:function(t){this._strokeWidth=t}},{key:"update",value:function(){var t,e;t=this._strokeColor?this.toRGBAColorString(this._strokeColor,this._strokeOpacity):"rgba(0,0,0,0)",e=this._fillColor?this.toRGBAColorString(this._fillColor,this._fillOpacity):"rgba(0,0,0,0)",L.log("this._strokeColor",this._strokeColor,"this._fillColor",this._fillColor),L.log("tempStrokeColor",t,"tempFillColor",e),this._canvasContext.strokeStyle=t,this._canvasContext.fillStyle=e,this._canvasContext.lineWidth=this._strokeWidth,this._canvasContext.clearRect(0,0,this._width,this._height),this._canvasContext.fill(),this._canvasContext.stroke(),this._texture.needsUpdate=!0}},{key:"drawStyledText",value:function(t){t.path.draw(this._canvasContext),this._texture.needsUpdate=!0}},{key:"drawImage",value:function(t,e,i,n,o){this._canvasContext.drawImage(t,e||0,i||0,n||this._width,o||this._height),this._texture.needsUpdate=!0}},{key:"toRGBAColorString",value:function(t,e){return"rgba("+Math.floor(255*t.r)+","+Math.floor(255*t.g)+","+Math.floor(255*t.b)+","+e+")"}}],[{key:"CreateRect",value:function(e){var n=i(e,"width",100),o=i(e,"height",100),s=i(e,"strokeWidth",1),r=i(e,"strokeColor",0),a=i(e,"fillColor",0),h=i(e,"fillOpacity",1),u=i(e,"strokeOpacity",1),l=document.createElement("canvas");l.width=n,l.height=o;var c=l.getContext("2d");return c.lineWidth=s,c.beginPath(),c.lineTo(0,0),c.lineTo(n,0),c.lineTo(n,o),c.lineTo(0,o),c.lineTo(0,0),c.closePath(),c.fill(),c.stroke(),e={},e.canvas=l,e.width=n,e.height=o,e.strokeWidth=s,e.strokeColor=r,e.fillColor=a,e.fillOpacity=h,e.strokeOpacity=u,new t(e)}},{key:"CreateCircle",value:function(e){var n=i(e,"radius",100),o=i(e,"strokeWidth",1),s=i(e,"strokeColor",0),r=i(e,"fillColor",0),a=i(e,"fillOpacity",1),h=i(e,"strokeOpacity",1),u=document.createElement("canvas");u.width=n+o,u.height=n+o;var l=u.getContext("2d");return l.strokeStyle=s?s.getHexString():void 0,l.fillStyle=r?r.getHexString():void 0,l.lineWidth=o,l.beginPath(),l.arc(n/2+o/2,n/2+o/2,n/2,0,2*Math.PI,!1),l.closePath(),l.fill(),l.stroke(),document.body.appendChild(u),e={},e.canvas=u,e.width=n,e.height=n,e.strokeWidth=o,e.strokeColor=s,e.fillColor=r,e.fillOpacity=a,e.strokeOpacity=h,new t(e)}}]),t}(),Nt=function(){function t(e){r(this,t),this.canvas=document.createElement("canvas"),this.canvas.width=512,this.canvas.height=512;var i=this.canvas.getContext("2d");i.fillStyle="rgba(0,0,255,255)",i.lineTo(0,0),i.lineTo(this.canvas.width,0),i.lineTo(this.canvas.width,this.canvas.height),i.lineTo(0,this.canvas.height),i.lineTo(0,0),i.closePath(),i.fill(),i.stroke(),document.body.appendChild(this.canvas);var n=new Image;n.src=this.canvas.toDataURL("image/png");var o=document.createElement("img");o.src=n.src,document.body.appendChild(o),this.texture=new THREE.Texture(n),this.texture.needsUpdate=!0,document.body.appendChild(e);var s=this;domvas.toImage(e,function(){i.drawImage(this,0,0),n.src=s.canvas.toDataURL("image/png"),o.src=n.src,s.update()})}return a(t,[{key:"update",value:function(){var t=new Image;t.src=this.canvas.toDataURL(),this.texture.image=t,this.texture.needsUpdate=!0}}],[{key:"addCSSToNode",value:function(t,e){var i=document.styleSheets[0].cssRules;if(i)for(var n=0;n<i.length;n++){var o=i[n].selectorText;if(o&&o.indexOf(e)>0)return void t.classList.add(e)}console.error("no css class of this name found. Remove the . if any in your argument")}}]),t}(),Ht=function(){function t(e){r(this,t),this.currentTime=0,this.playing=!1,this.frameRate=10,this.context=e,this.textures=[],this.sequenceMode="FORWARD",this.direction=1,this.lapsToDo=-1,this.frameCount=0,this.laps=0,this.currentFrame=0}return a(t,[{key:"load",value:function(t,e,i){for(var n=e;n<=i;++n){var o=new U({context:this.context}),s=t.replace("*",""+n);o.loadFromFile(s,!0),this.textures.push(o)}this.frameCount=this.textures.count,this.enterFrame=0,this.currentFrame=0,this.outFrame=i}},{key:"setEnterFrame",value:function(t){t>=0&&t<this.frameCount?(this.enterFrame=t,this.currentFrame=this.enterFrame):(this.enterFrame=0,this.currentFrame=0,L.log("ERROR enterFrame %i is out of sequence bounds - back to 0",t))}},{key:"setOutFrame",value:function(t){t>=this.enterFrame&&t<this.frameCount?this.outFrame=t:(this.outFrame=this.frameCount-1,L.log("ERROR outFrame %i is out of sequence bounds - back to frameCount",t))}},{key:"setMode",value:function(t){this.sequenceMode=t}},{key:"update",value:function(){this.playing&&(this.currentTime+=this.context.Time.deltaTime,this.currentTime>1/this.frameRate&&(this.currentTime-=1/this.frameRate,"FORWARD"===this.sequenceMode?(this.laps>=0&&this.laps<this.lapsToDo?(this.currentFrame++,this.currentFrame%=this.outFrame+1,0===this.currentFrame&&(this.currentFrame=this.enterFrame),this.currentFrame===this.outFrame&&this.laps++):this.lapsToDo<0&&(this.currentFrame++,this.currentFrame%=this.outFrame+1,0===this.currentFrame&&(this.currentFrame=this.enterFrame)),this.lapsToDo===this.laps&&this.stop(),L.log("currentFrame = "+this.currentFrame)):"BACKWARD"===this.sequenceMode?(this.laps>=0&&this.laps<this.lapsToDo?(this.currentFrame--,this.currentFrame<this.enterFrame&&(this.currentFrame=this.outFrame),this.currentFrame===this.enterFrame&&this.laps++):this.lapsToDo<0&&--this.currentFrame<this.enterFrame&&(this.currentFrame=this.outFrame),this.lapsToDo===this.laps&&this.stop(),L.log("currentFrame = "+this.currentFrame)):"PINGPONG"===this.sequenceMode?(this.laps>=0&&this.laps<this.lapsToDo?(this.currentFrame+=this.direction,this.currentFrame<0&&(this.currentFrame=0),this.currentFrame>this.outFrame&&(this.currentFrame=this.outFrame),this.currentFrame>=this.outFrame&&(this.direction=-this.direction,this.laps++),this.currentFrame<=this.enterFrame&&(this.direction=-this.direction,this.laps++)):this.lapsToDo<0&&(this.currentFrame+=this.direction,this.currentFrame>=this.outFrame&&(this.direction=-this.direction),this.currentFrame<=this.enterFrame&&(this.direction=-this.direction)),this.lapsToDo===this.laps&&this.stop(),L.log("currentFrame = "+this.currentFrame)):"RANDOM"===this.sequenceMode&&(this.currentFrame=Math.floor(Math.random()*(this.outFrame-this.enterFrame)+this.enterFrame),L.log("currentFrame = "+this.currentFrame))))}},{key:"getCurrentTexture",value:function(){return this.textures[this.currentFrame]}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1}},{key:"stop",value:function(){this.currentTime=0,this.currentFrame=0,this.playing=!1,this.laps=0}},{key:"loop",value:function(t){this.lapsToDo=t}}]),t}(),Vt=function(){function t(n){r(this,t),this._width=i(n,"width",512),this._height=i(n,"height",512),this._engineTexture=new e.WebGLRenderTarget(this._width,this._height,{minFilter:e.LinearFilter,magFilter:e.NearestFilter,format:e.RGBFormat}),this._texture=this._engineTexture.texture}return a(t,[{key:"getTexture",value:function(){return this._engineTexture.texture}}]),t}(),Yt=function(){function t(e){r(this,t),this._video=i(e,"video",void 0),this._loop=i(e,"loop",!1),this._autoPlay=i(e,"autoPlay",!1),this._fps=i(e,"fps",30),this._isIOS="iOS"===q.getOS(),this._isPlaying=!1,this._bufferedPourcent={start:0,end:0},this._isIOS&&(this._autoPlay=!1,this._videoCanvasTexture=new Xt({width:this._video.videoWidth,height:this._video.videoHeight})),this._video.addEventListener("progress",this.onLoadProgess.bind(this)),this._video.addEventListener("ended",this.onVideoEnded.bind(this)),this._isIOS?this._texture=this._videoCanvasTexture._texture:(this._texture=new THREE.Texture(this._video),this._texture.generateMipmaps=!1,this._texture.minFilter=THREE.NearestFilter,this._texture.magFilter=THREE.NearestFilter),this._autoPlay&&!this._isIOS&&this.play()}return a(t,[{key:"onLoadProgess",value:function(t){var e=this.getBuffered();L.log("progress",e,this.getDuration()),e&&e.length>=1&&(this._bufferedPourcent={start:100*this.getBuffered().start(0)/this.getDuration(),end:100*this.getBuffered().end(0)/this.getDuration()})}},{key:"onVideoEnded",value:function(t){this._loop?this.play():this.stop()}},{key:"setLoop",value:function(t){this._loop=t}},{key:"update",value:function(){if(this._video.readyState>=this._video.HAVE_FUTURE_DATA){if(this._isIOS&&this._isPlaying){var t=Date.now(),e=(t-this.lastTime)/1e3;e>=1/this._fps&&(this._video.currentTime=this._video.currentTime+e,this.lastTime=t,this._videoCanvasTexture.drawImage(this._video))}!this._isIOS&&this._texture&&(this._texture.needsUpdate=!0)}}},{key:"play",value:function(){this._isIOS?this.lastTime=Date.now():this._video.play(),this._isPlaying=!0}},{key:"pause",value:function(){this._video.pause(),this._isPlaying=!1}},{key:"stop",value:function(){this._video.pause(),this._video.currentTime=0,this._isPlaying=!1}},{key:"getIsPlaying",value:function(){return this._isPlaying}},{key:"getCurrentTime",value:function(){return this._video.currentTime}},{key:"getBuffered",value:function(){return this._video.buffered}},{key:"setCurrentTime",value:function(t){this._video.currentTime<this._video.duration?this._video.currentTime=t:this._video.currentTime=this._video.duration}},{key:"getDuration",value:function(){return this._video.duration}},{key:"setPlaybackRate",value:function(t){this._video.playbackRate=t}},{key:"getPlaybackRate",value:function(){return this._video.playbackRate}},{key:"getWidth",value:function(){return this._video.videoWidth}},{key:"getHeight",value:function(){return this._video.videoHeight}}]),t}(),Gt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return L.log("constructor post super"),n.interval=i(t,"interval",100),n.callback=i(t,"callback",null),n}return u(e,t),a(e,[{key:"setup",value:function(){this.startTime=(new Date).getTime(),this.currentTime=(new Date).getTime()}},{key:"off",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this.stop()}},{key:"start",value:function(){this._active?(this.startTime=(new Date).getTime(),this.currentTime=(new Date).getTime()):L.info("component is off")}},{key:"stop",value:function(){this.startTime=0,this.currentTime=0}},{key:"update",value:function(){if(this._active){this.currentTime=(new Date).getTime();this.currentTime-this.startTime>=this.interval&&(this.callback(),this.reset())}}},{key:"reset",value:function(){this.startTime=(new Date).getTime(),this.currentTime=(new Date).getTime()}}]),e}(g),qt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._startTime=i(t,"startTime",0),n._timeScale=i(t,"scale",1),n._smoothingFactor=i(t,"smoothingFactor",.9),n._NTPEnabled=i(t,"NtpEnabled",!1),n._currentTime=0,n._deltaTime=0,n._timeOffsetSmooth=0,n._lastTime=(new Date).getTime(),n._offset=0,n}return u(e,t),a(e,[{key:"setup",value:function(){if(this._lastTime=(new Date).getTime(),this._offset=this._lastTime-this._startTime,this._NTPEnabled){var t=new WebSocket("ws://ntp.surexposition.mobi:8000/");ntp_websockets.init(t),setInterval(function(){this._offset=ntp_websockets.offset()},1e3)}}},{key:"start",value:function(){this._startTime=(new Date).getTime()}},{key:"pause",value:function(){}},{key:"reset",value:function(){this._startTime=0}},{key:"update",value:function(){if(this.getStatus()){var t=(new Date).getTime();this._deltaTime=(t-this._currentTime)/1e3,this._currentTime=t}}},{key:"setTimeScale",value:function(t){this._timeScale=t}},{key:"getTimeScale",value:function(){return this._timeScale}},{key:"getDelta",value:function(){return this._deltaTime*this._timeScale}},{key:"getTime",value:function(){return(this._currentTime+this._offset)*this._timeScale}},{key:"getTimeSmooth",value:function(){return this._timeOffsetSmooth=this._timeOffsetSmooth*this._startTime+this._offset*(1-this._startTime),(this._currentTime+this._timeOffsetSmooth)*this._timeScale}},{key:"getDateTime",value:function(){return(new Date).getTime()}},{key:"resync",value:function(){this._NTPEnabled&&ntp_websockets.resync()}}]),e}(g),Qt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.pointer=i(t,"pointer",void 0),n.onPress=i(t,"onPress",function(){}),n.onRelease=i(t,"onRelease",function(){}),n.onEnter=i(t,"onEnter",function(){}),n.onLeave=i(t,"onLeave",function(){}),n.camera=t.camera,n.target=i(t,"target",void 0),n.picked=!1,n.hovered=!1,n}return u(e,t),a(e,[{key:"setup",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setup",this).call(this);var i=this.getContext();if(!this.pointer){var n=new J;i.addComponent(n),n.setup(),n.on(),this.pointer=new Pt,this.pointer.add(n),i.addComponent(this.pointer),this.pointer.setup(),this.pointer.on()}this.pointer.events.on("on",function(e){t.target.transform.pick(t.camera,e.x,e.y)?(t.picked=!0,t.onPress()):t.picked=!1}),this.pointer.events.on("off",function(e){t.target.transform.pick(t.camera,e.x,e.y);!0===t.picked&&t.onRelease()}),this.pointer.events.on("moved",function(e){t.target.transform.pick(t.camera,e.x,e.y)?(t.picked=!0,t.hovered||(t.onEnter(),t.hovered=!0)):t.picked&&(t.onLeave(),t.hovered=!1,t.picked=!1)})}}]),e}(g),Kt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(n.camera=t.camera,n.pointer=i(t,"pointer",void 0),n.mesh=i(t,"mesh",void 0),n.width=i(t,"width",3),n.height=i(t,"height",1),n.radius=i(t,"radius",void 0),n.sideCount=i(t,"sideCount",6),n.cutOff=i(t,"cutOff",n.height/3),n.strokeWidth=i(t,"strokeWidth",.1),n.strokeColor=i(t,"strokeColor",p.mobilizing.clone()),n.fillColor=i(t,"fillColor",p.white.clone()),n.pressFillColor=i(t,"pressFillColor",p.mobilizing.clone()),n.hoverFillColor=i(t,"hoverFillColor",p.mobilizingAlternate.clone()),n.onPress=i(t,"onPress",function(){}),n.onRelease=i(t,"onRelease",function(){}),n.onEnter=i(t,"onEnter",function(){}),n.onLeave=i(t,"onLeave",function(){}),n._fontURL=i(t,"fontURL","fonts/Raleway-Regular.ttf"),n._fontItalicURL=i(t,"fontItalicURL","fonts/Raleway-Regular-Italic.ttf"),n._fontBoldURL=i(t,"fontBoldURL","fonts/Raleway-Bold.ttf"),n._fontBoldItalicURL=i(t,"fontBoldItalicURL","fonts/Raleway-Bold-Italic.ttf"),n.text=i(t,"text",void 0),n.textSize=i(t,"textSize",40),n.root=new N({primitive:"node"}),n.transform=n.root.transform,n.text){var o=void 0;o=n.width<100?512:n.width;var s=void 0;if(s=n.height<100?o/(n.width/n.height):n.height,n.radius){s=o*(2/Math.sqrt(3))}var a=new Mobilizing.RichText({width:o,height:s,text:n.text,marginTop:s/2-n.textSize/2,backgroundColor:p.transparent.makeRGBAStringWithAlpha(0),textColor:p.mobilizing.clone(),textAlign:"center",textSize:n.textSize,fontURL:n._fontURL,fontItalicURL:n._fontItalicURL,fontBoldURL:n._fontBoldURL,fontBoldItalicURL:n._fontBoldItalicURL}),h=new Mobilizing.RichText({width:o,height:s,text:n.text,marginTop:s/2-n.textSize/2,backgroundColor:p.transparent.makeRGBAStringWithAlpha(0),textColor:p.white.clone(),textAlign:"center",textSize:n.textSize,fontURL:n._fontURL,fontItalicURL:n._fontItalicURL,fontBoldURL:n._fontBoldURL,fontBoldItalicURL:n._fontBoldItalicURL});n.textTexture=new U({canvas:a.getCanvas()}),n.pressTextTexture=new U({canvas:h.getCanvas()})}return n.mesh||n.generateDefaultMesh(),n.root.transform.addChild(n.mesh.transform),n}return u(e,t),a(e,[{key:"setup",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setup",this).call(this);var i=this.getContext();this.clickable=new Qt({camera:this.camera,target:this.mesh,pointer:this.pointer,onPress:function(){t._active&&(t.mesh.material.setColor(t.pressFillColor),t.pressTextTexture&&t.texturedMesh.material.setTexture(t.pressTextTexture),t.onPress())},onRelease:function(){t._active&&(t.mesh.material.setColor(t.hoverFillColor),t.textTexture&&t.texturedMesh.material.setTexture(t.textTexture),t.onRelease())},onEnter:function(){t._active&&(t.mesh.material.setColor(t.hoverFillColor),t.onEnter())},onLeave:function(){t._active&&(t.mesh.material.setColor(t.fillColor),t.textTexture&&t.texturedMesh.material.setTexture(t.textTexture),t.onLeave())}}),i.addComponent(this.clickable),this.clickable.setup(),this.on()}},{key:"on",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this),this.mesh.material.setOpacity(1),this.strokeMesh.material.setOpacity(1),this.text&&this.texturedMesh.material.setOpacity(1)}},{key:"off",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"off",this).call(this),this.mesh.material.setOpacity(.3),this.strokeMesh.material.setOpacity(.3),this.text&&this.texturedMesh.material.setOpacity(.3)}},{key:"generateDefaultMesh",value:function(){var t=this.width/2,e=this.height/2;if(this.vertex=[],this.radius)for(var i=this.sideCount,n=this.radius,o=0;o<i;o++)this.vertex.push(new b(Math.cos(T.degToRad(360/i/2)+2*Math.PI/i*o)*n,Math.sin(T.degToRad(360/i/2)+2*Math.PI/i*o)*n));else this.vertex.push(new b(-t+this.cutOff,e)),this.vertex.push(new b(t-this.cutOff,e)),this.vertex.push(new b(t,e-this.cutOff)),this.vertex.push(new b(t,-e+this.cutOff)),this.vertex.push(new b(t-this.cutOff,-e)),this.vertex.push(new b(-t+this.cutOff,-e)),this.vertex.push(new b(-t,-e+this.cutOff)),this.vertex.push(new b(-t,e-this.cutOff));this.topLeftIndex=0,this.topRightIndex=1,this.bottomRightIndex=4,this.bottomLeftIndex=5,this.mesh=new N({primitive:"custom"}),this.mesh.generateFillMesh(this.vertex),this.mesh.material.setTransparent(!0),this.text&&(this.texturedMesh=new N({primitive:"custom"}),this.texturedMesh.generateFillMesh(this.vertex),this.texturedMesh.material.setTransparent(!0),this.texturedMesh.material.setTexture(this.textTexture),this.root.transform.addChild(this.texturedMesh.transform)),this.strokeMesh=N.generateStrokeMesh(this.mesh,this.strokeWidth),this.strokeMesh.material.setColor(this.strokeColor),this.strokeMesh.material.setTransparent(!0),this.root.transform.addChild(this.strokeMesh.transform)}},{key:"adaptCorner",value:function(t,e){if(this.width!==this.height){switch(e){case"topLeft":var i=this.mesh._geometry.vertices[this.topLeftIndex];"straight"===t?i.x=-this.width/2:"cutOff"===t&&(i.x=-this.width/2+this.cutOff),this.mesh.updateMesh(),this.regenerateStrokeGeometry(this.mesh);break;case"topRight":var i=this.mesh._geometry.vertices[this.topRightIndex];"straight"===t?i.x=this.width/2:"cutOff"===t&&(i.x=this.width/2-this.cutOff),this.mesh.updateMesh(),this.regenerateStrokeGeometry(this.mesh);break;case"bottomRight":var i=this.mesh._geometry.vertices[this.bottomRightIndex];"straight"===t?i.x=this.width/2:"cutOff"===t&&(i.x=this.width/2-this.cutOff),this.mesh.updateMesh(),this.regenerateStrokeGeometry(this.mesh);break;case"bottomLeft":var i=this.mesh._geometry.vertices[this.bottomLeftIndex];"straight"===t?i.x=-this.width/2:"cutOff"===t&&(i.x=-this.width/2+this.cutOff),this.mesh.updateMesh(),this.regenerateStrokeGeometry(this.mesh)}this.mesh.generateFlatUVs()}}},{key:"regenerateStrokeGeometry",value:function(t){this.strokeMesh.updateStroke(t,this.strokeWidth)}},{key:"fakePress",value:function(){this.fakePressed=!0}}]),e}(g),Zt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),o=(i(t,"rows",3),i(t,"columns",2)),s=i(t,"mode","grid"),a=i(t,"offsetType","even");if(n.buttons=i(t,"buttons",[]),n.orderedIndices=[],n.width=0,n.height=0,n.root=new N({primitive:"node"}),n.transform=n.root.transform,n.buttons.length>0){for(var h=0;h<n.buttons.length;h++)n.root.transform.addChild(n.buttons[h].transform);n.organize(s,o,a)}return n}return u(e,t),a(e,[{key:"organize",value:function(t,e,i){switch(console.log(t,e,i),t){case"grid":var n=this.organizeGrid(e);this.positionGrid(n)}switch(t){case"honeycomb":var o=this.organizeGrid(e);this.positionHoneyComb(o,i)}}},{key:"organizeGrid",value:function(t){for(var e=[],i=0;i<this.buttons.length;i++)0!==i&&i%t!=0||(e[e.length]=[]),e[e.length-1].push({index:i,position:new C,isTop:!1,isBottom:!1,isLeft:!1,isRight:!1});return e}},{key:"positionGrid",value:function(t){for(var e=0,i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.length;o++){var s=this.buttons[n[o].index];n[o].position.x=o*(s.width+s.strokeWidth),n[o].position.y=i*-(s.height+s.strokeWidth),0===i&&(n[o].isTop=!0),i===t.length-1&&(n[o].isBottom=!0),0===o&&(n[o].isLeft=!0),o===n.length-1&&(n[o].isRight=!0,e+n.length>this.buttons.length-1&&(n[o].isBottom=!0)),this.orderedIndices.push(n[o]),e++}this.renderGrid()}},{key:"renderGrid",value:function(){for(var t=0;t<this.orderedIndices.length;t++){var e=this.orderedIndices[t],i=this.buttons[t];i.transform.setLocalPosition(e.position),e.isTop&&e.isLeft&&e.isBottom&&!e.isRight&&(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight")),e.isTop&&!e.isLeft&&e.isBottom&&!e.isRight&&(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight"),i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft")),e.isTop&&!e.isLeft&&e.isBottom&&e.isRight&&(i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft")),!e.isTop||e.isLeft||e.isBottom||e.isRight||(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight"),i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft")),e.isTop&&e.isLeft&&!e.isBottom&&!e.isRight&&(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight"),i.adaptCorner("straight","bottomLeft")),e.isTop&&!e.isLeft&&!e.isBottom&&e.isRight&&(i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft"),i.adaptCorner("straight","bottomRight")),e.isTop||e.isBottom||(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight"),i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft")),!e.isTop&&e.isLeft&&e.isBottom&&e.isRight&&(i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","topRight")),!e.isTop&&e.isLeft&&e.isBottom&&!e.isRight&&(i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight")),!e.isTop&&!e.isLeft&&e.isBottom&&e.isRight&&(i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomLeft")),e.isTop||e.isLeft||!e.isBottom||e.isRight||(i.adaptCorner("straight","topRight"),i.adaptCorner("straight","bottomRight"),i.adaptCorner("straight","topLeft"),i.adaptCorner("straight","bottomLeft"))}this.computeSize()}},{key:"positionHoneyComb",value:function(t,e){for(var i=0,n=0;n<t.length;n++)for(var o=t[n],s=0;s<o.length;s++){var r=this.buttons[o[s].index],a=3*r.mesh.getBoundingBox().getSize().y/4;o[s].position.x=s*(r.mesh.getBoundingBox().getSize().x+r.strokeWidth),o[s].position.y=n*-(a+r.strokeWidth),n%2==1&&("odd"===e?o[s].position.x-=(r.mesh.getBoundingBox().getSize().x+r.strokeWidth)/2:o[s].position.x+=(r.mesh.getBoundingBox().getSize().x+r.strokeWidth)/2),this.orderedIndices.push(o[s]),i++}this.renderHoneyComb()}},{key:"renderHoneyComb",value:function(){for(var t=0;t<this.orderedIndices.length;t++){var e=this.orderedIndices[t];this.buttons[t].transform.setLocalPosition(e.position)}this.computeSize()}},{key:"computeSize",value:function(){var t=this.buttons[0].mesh.getBoundingBox();t.expandByObject(this.root.transform.entity),console.log(t),this.width=t.getSize().x,this.height=t.getSize().y,console.log(this.width,this.height)}}]),e}(g),Jt=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.setName(i(t,"name",void 0)),n._ready=!1,n._styledLetters=[],n._maxCharCount=i(t,"maxCharCount",1e3),n._maxLineCount=i(t,"maxLineCount",1),n._size=i(t,"size",20),n._color=i(t,"color",p.gray),n._backgroundColor=i(t,"backgroundColor",p.white),n._lineHeight=i(t,"lineHeight",1),n._margins=i(t,"margins",10),n._width=i(t,"width",300),n._height=i(t,"height",100),n._fontURL=i(t,"fontURL","fonts/Raleway-Regular.ttf"),n._fontItalicURL=i(t,"fontItalicURL","fonts/Raleway-Regular-Italic.ttf"),n._fontBoldURL=i(t,"fontBoldURL","fonts/Raleway-Bold.ttf"),n._fontBoldItalicURL=i(t,"fontBoldItalicURL","fonts/Raleway-Bold-Italic.ttf"),n._font=i(t,"font",void 0),n._currentFont=n._font,n._cursorColor=i(t,"cursorColor",n._color),n._cursorWidth=i(t,"cursorWidth",2),n._blinkTime=i(t,"blinkTime",300),n._blinkState=!1,setInterval(n.onBlink.bind(n),n._blinkTime),n._cursorIndex=-1,n._cursorX=0,n._cursorY=0,n._canvas=document.createElement("canvas"),n._canvas.width=n._width,n._canvas.height=n._height,n._canvasContext=n._canvas.getContext("2d"),n._canvas.events=new v({scope:n._canvas}),Tt.loadArrayBuffer(n._fontURL,function(t){n._defaultFontFile=t,Tt.loadArrayBuffer(n._fontItalicURL,function(t){n._defaultItalicFontFile=t,Tt.loadArrayBuffer(n._fontBoldURL,function(t){n._defaultBoldFontFile=t,Tt.loadArrayBuffer(n._fontBoldItalicURL,function(t){n._defaultBoldItalicFontFile=t,n.setup()})})})}),n}return u(e,t),a(e,[{key:"setup",value:function(){this._defaultFont=new Dt({fontFile:this._defaultFontFile}),this._defaultItalicFont=new Dt({fontFile:this._defaultItalicFontFile}),this._defaultBoldFont=new Dt({fontFile:this._defaultBoldFontFile}),this._defaultBoldItalicFont=new Dt({fontFile:this._defaultBoldItalicFontFile}),this._currentFont=this._defaultFont,this.render()}},{key:"setFont",value:function(t){this._currentFont=t}},{key:"setSize",value:function(t){this._size=t}},{key:"setColor",value:function(t){this._color=t}},{key:"addLetter",value:function(t){var e=t.charCodeAt(0),i=String.fromCharCode(e);"\n"===t&&(i=t);var n=new Bt({letter:i,font:this._currentFont,size:this._size,color:this._color});this._styledLetters.splice(this._cursorIndex+1,0,n),this.moveCursorForward(),this.render()}},{key:"delete",value:function(){this._cursorIndex>=0&&(this._styledLetters.splice(this._cursorIndex,1),this.moveCursorBack())}},{key:"onBlink",value:function(){this._blinkState=!this._blinkState,this.render()}},{key:"moveCursorForward",value:function(){this._cursorIndex++,this._cursorIndex>this._styledLetters.length-1&&(this._cursorIndex=this._styledLetters.length-1),0===this._styledLetters.length&&(this._cursorIndex=-1),this.render()}},{key:"moveCursorBack",value:function(){this._cursorIndex--,this._cursorIndex<-1&&(this._cursorIndex=-1),this.render()}},{key:"moveCursorTo",value:function(t){t>=-1&&t<this._styledLetters.length&&(this._cursorIndex=t,this.render())}},{key:"pickLetter",value:function(t,e){for(var i=0;i<this._styledLetters.length;i++){var n=this._styledLetters[i],o=n.path.getBoundingBox(),s=[{x:o.x1,y:o.y1},{x:o.x2,y:o.y1},{x:o.x2,y:o.y2},{x:o.x1,y:o.y2}];if(T.pointIsInside(t,e,s))return{index:i,letter:this._styledLetters[i]}}}},{key:"render",value:function(){this._canvasContext.fillStyle="#"+this._backgroundColor.getHexString(),this._canvasContext.fillRect(0,0,this._width,this._height);for(var t=this._margins,e=this._margins,i=0;i<this._styledLetters.length;i++)if(i<this._maxCharCount){var n=this._styledLetters[i];e===this._margins&&(e+=n.size);var o=t+n.width;o>this._width-this._margins&&(e+=n.size,t=this._margins),"\n"===n.letter&&(e+=n.size,t=this._margins),n.setX(t),n.setY(e),n.update(),n.path.draw(this._canvasContext),t+=n.width}if(this._blinkState){var s=this._styledLetters[this._cursorIndex];if(s){var r=s.path.getBoundingBox();this._canvasContext.beginPath(),s.height<1?(this._canvasContext.moveTo(s.x+s.width,s.y),this._canvasContext.lineTo(s.x+s.width,s.y),this._canvasContext.lineTo(s.x+s.width,s.y-this._size)):(this._canvasContext.moveTo(r.x2,r.y1),this._canvasContext.lineTo(r.x2,r.y1),this._canvasContext.lineTo(r.x2,r.y2))}else this._canvasContext.beginPath(),this._canvasContext.moveTo(this._margins,this._margins),this._canvasContext.lineTo(this._margins,this._margins),this._canvasContext.lineTo(this._margins,this._margins+this._size);this._canvasContext.lineWidth=this._cursorWidth,this._canvasContext.strokeStyle="#"+this._cursorColor.getHex(),this._canvasContext.stroke()}this._canvas.events.trigger("drawn")}},{key:"getWidth",value:function(){return this._width}},{key:"getHeight",value:function(){return this._height}},{key:"getCanvas",value:function(){return this._canvas}}]),e}(f),$t=function(t){function i(t){return r(this,i),l(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return u(i,t),a(i,[{key:"init",value:function(t){void 0===t&&(t={}),h(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"init",this).call(this,t),t.context=this,this.audio=this.addComponent(new Mobilizing.RendererAudio(t)),this.renderer=this.addComponent(new Mobilizing.Renderer3D(t)),this.physics=this.addComponent(new Mobilizing.PhysicsEngine(t)),this.time=this.addComponent(new Mobilizing.Time(t)),this.touch=this.addComponent(new Mobilizing.input.Touch({context:this}))}},{key:"update",value:function(t){h(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"update",this).call(this,t)}},{key:"getMainRenderer",value:function(){return this.renderer}},{key:"getRenderingSurface",value:function(){return this.canvas}},{key:"getTouchSurface",value:function(){return this.canvas}},{key:"setCurrentScene",value:function(t){this.renderer.setCurrentScene(t)}},{key:"addToCurrentScene",value:function(t){this.renderer.addToCurrentScene(t)}},{key:"removeFromCurrentScene",value:function(t){this.renderer.removeFromCurrentScene(t)}},{key:"clear",value:function(){this.renderer.clear()}},{key:"addCamera",value:function(t){this.renderer.addCamera(t)}},{key:"removeCamera",
value:function(t){this.renderer.removeCamera(t)}},{key:"getCanvasSize",value:function(){return{width:this.canvas.width/window.devicePixelRatio,height:this.canvas.height/window.devicePixelRatio}}},{key:"beep",value:function(t){this.audio.beep(t)}},{key:"getCanvasPosition",value:function(){return Z.getElementPosition(this.canvas)}},{key:"updateCanvasPosition",value:function(){this.canvasPosition=this.getCanvasPosition()}},{key:"createCube",value:function(){var t=new Mobilizing.Mesh({primitive:"box"});return this.addToCurrentScene(t),t}},{key:"createSphere",value:function(){var t=new Mobilizing.Mesh({primitive:"sphere"});return this.addToCurrentScene(t),t}},{key:"createPlane",value:function(t,e){var i=new Mobilizing.Mesh({primitive:"plane"});return this.addToCurrentScene(i),i}},{key:"createLight",value:function(){var t=new(Function.prototype.bind.apply(Mobilizing.Light,[null].concat(Array.prototype.slice.call(arguments))));return this.addToCurrentScene(t),t}},{key:"createLabel",value:function(t){t.context=this;var e=new Mobilizing.Label(t);return this.addToCurrentScene(e),e}},{key:"createMesh",value:function(t){t.context=this;var e=new Mobilizing.Mesh(t);return this.addToCurrentScene(e),e}},{key:"createCamera",value:function(){var t=new(Function.prototype.bind.apply(Mobilizing.Camera,[null].concat(Array.prototype.slice.call(arguments))));return this.addCamera(t),this.addToCurrentScene(t),t}},{key:"createCameraX",value:function(t){var e=new Mobilizing.Camera(t.type);return this.addCamera(e),this.addToCurrentScene(e),void 0!==t.fov&&e.setFOV(t.fov),void 0!==t.position&&e.transform.setLocalPosition(t.position),void 0!==t.layer&&(e.layer=t.layer),e}},{key:"createTextLabel",value:function(t,e,i,n,o,s,r,a,h){var u=new Mobilizing.Label(t,e,n,o);return u.style.fontSize=i,u.style.color=s,void 0!==r?(u.style.hasBackground=!0,u.style.backgroundColor=r):u.style.hasBackground=!1,u.style.textAlign="center",void 0!==a?(u.material.texture=a,u.transform.setLocalScale(n,o,1)):u.render(),this.addToCurrentScene(u),u}},{key:"createVideoQuad",value:function(t){var e=new Mobilizing.Mesh({primitive:"plane"});return e.vt=new Mobilizing.VideoTexture,e.vt.loadFromFile(t),e.material.setTexture(e.vt),this.addToCurrentScene(e),e}},{key:"loadFont",value:function(t){return new Mobilizing.Font(t,this)}},{key:"loadObj3dModel",value:function(t,e){var i=new Mobilizing.Mesh;i.material=new Mobilizing.Material({type:"lambert"}),i.updateMaterial(),i.loadFromFile(t,this.onObjLoaded.bind(this));var n=new Mobilizing.Texture({context:this});return n.loadFromFile(e),i.material.setTexture(n),i}},{key:"onObjLoaded",value:function(t){this.addToCurrentScene(t)}},{key:"createAudioSource",value:function(t){var e=new Mobilizing.AudioSource(this);return e.set3D(!1),new Mobilizing.AudioBuffer(this).loadFromURL(t,this.onBufferLoaded.bind(this)),e}},{key:"onBufferLoaded",value:function(t,e){}},{key:"createTexture",value:function(){return new Mobilizing.Texture({context:this})}},{key:"createTextureFromCubeCamera",value:function(t){var i=new Mobilizing.Texture({context:this});return i.cube=t._camera.renderTarget,i.cube.minFilter=e.LinearMipMapLinearFilter,i}},{key:"loadTexture",value:function(t,e){var i=new Mobilizing.Texture({context:this});return i.loadFromFile(t,e),i}},{key:"createTextButton",value:function(t,e,i,n,o,s,r){var a=Mobilizing.Button.CreateButton(void 0,t,n,o,s,e,i,void 0,void 0,this);return a.transform.setLocalScale(r),this.addToCurrentScene(a),a}}]),i}(Lt),te={Keyboard:K,Mouse:J,Touch:tt,Motion:et,Orientation:it,GPS:nt},ee={Ajax:gt,PubSub:Et};t.version="0.0.1",t.revision="d29bcfa",t.input=te,t.net=ee,t.GPSUtils=st,t.math=T,t.getOrDefault=i,t.AudioBuffer=d,t.AudioSource=y,t.Color=p,t.Euler=m,t.Matrix3=_,t.Matrix4=x,t.Quaternion=k,t.Rect=w,t.Vector2=b,t.Vector3=C,t.Animation=A,t.Csg=V,t.Debug=M,t.debug=L,t.Device=q,t.BatteryStatus=Q,t.MeshFX=rt,t.Midi=at,t.Profiler=ht,t.Runner=Ot,t.Loader=Tt,t.Cache=St,t.Pointer=Pt,t._DOM=Z,t.PhysicsEngine=zt,t.Engine3D=Ft,t.Camera=I,t.Font=Dt,t.Light=W,t.LODGroup=At,t.Material=B,t.Transform=X,t.Label=j,t.Mesh=N,t.EdgesMesh=H,t.StyledLetter=Bt,t.StyledTextElement=It,t.TextLine=Wt,t.RichText=jt,t.CanvasTexture=Xt,t.DOMNodeTexture=Nt,t.ImageSequenceTexture=Ht,t.RenderTexture=Vt,t.Texture=U,t.VideoTexture=Yt,t.Time=O,t.Timer=Gt,t.NTP=qt,t.Button=Kt,t.ButtonGroup=Zt,t.Clickable=Qt,t.TextField=Jt,t.Context=Lt,t.EasyContext=$t,Object.defineProperty(t,"__esModule",{value:!0})});
